<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Rezolve Inside (TM) SDK Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;swift&quot;,&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="swift">IOS</a>
              <a href="#" data-language-name="java">Android</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://www.rezolve.com'>Rezolve Homepage</a></li>
            <li><a href='https://github.com/tripit/slate'>Docs powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1><pre class="highlight html tab-html"><code>Note:

Code samples for IOS and Android will appear in this column.

You can switch between IOS and Android by clicking the tabs above.
</code></pre>
<p>The <strong>Rezolve Inside<sup>TM</sup> SDK</strong> is a software development kit that enables mobile app developers to integrate Rezolveâ€™s mobile commerce and engagement capabilities into their new or existing mobile apps.</p>

<p>To learn more about what the Rezolve Inside<sup>TM</sup> SDK can offer your app, <a href="images/RezolveOverview-Platform.pdf">click here for a platform overview PDF</a>.</p>
<h2 id='reference-app'>Reference App</h2>
<p>A Rezolve Reference App is available, and is a great way to experience Rezolve&#39;s offerings. A pdf of the screen flow is <a href="images/DemoAppFlowScreens.pdf">available here</a>.</p>

<p>If you would like access to the reference app, email Stephen Meli (stephen@rezolve.com) the following information:</p>

<ol>
<li>Your full name</li>
<li>Your company</li>
<li>What country you are located in</li>
<li>Your contact phone number (and Skype ID if you have one)</li>
<li>Your phone OS (Android or IOS), OS version (if you know it), and phone model</li>
<li>The email address associated with your Android or IOS account (the one associated with the Play Store/App Store)</li>
<li>Your contact email, if it differs from your account email</li>
</ol>
<h2 id='capabilities'>Capabilities</h2>
<p>The Rezolve Inside<sup>TM</sup> SDK is a full-featured application suite. Capabilities that can be integrated into your application include:</p>

<ul>
<li>Enabling Shoppable Ads - <a href="images/RezolveOverview-ShoppableAds.pdf">Shoppable Ads PDF</a></li>
<li>Creating a browsable Mall - <a href="images/RezolveOverview-Mall.pdf">Mall PDF</a></li>
<li>Supporting Pre-pay account Top Up - <a href="images/RezolveOverview-TopUp.pdf">Top Up PDF</a></li>
<li>Consumer management of topup devices</li>
<li>Scanning of Rezolve Encoded visual media</li>
<li>Scanning of Rezolve Encoded audio media</li>
<li>Consumer account creation, consumer profile, and purchase history</li>
<li>Wallet management</li>
</ul>

<!-- ************************
The Rezolve Inside<sup>TM</sup> SDK and Platform feature a robust and state-of-the-art security model (see <a href="images/RezolveOverview-Security.pdf">see security overview PDF</a>).
***************************** -->
<h2 id='intended-audience'>Intended audience</h2>
<p>This document is intended for experienced IOS and Android developer. It is expected that you have built apps before, and know your way around an IDE.</p>
<h2 id='term-definitions'>Term Definitions</h2>
<table><thead>
<tr>
<th>term</th>
<th>definition</th>
</tr>
</thead><tbody>
<tr>
<td>Partner</td>
<td>The Partner is the owner of a mobile application and audience. It is the Partner who wishes to integrate the Rezolve Inside<sup>TM</sup> SDK capabilities with their app.</td>
</tr>
<tr>
<td>Developer</td>
<td>The Developer is the mobile app developer of the Partner.</td>
</tr>
<tr>
<td>Merchant</td>
<td>A merchant runs an ecommerce site that offers products for sale. Merchants also create Shoppable Ads and link them to products. A merchant may also offer device accounts that need Top Up.</td>
</tr>
<tr>
<td>Consumer</td>
<td>The end user of the Partner&#39;s mobile app. The customer who buys merchant products.</td>
</tr>
<tr>
<td>SDK</td>
<td>Refers to the Rezolve Inside<sup>TM</sup> SDK, unless otherwise specified.</td>
</tr>
</tbody></table>
<h2 id='for-more-information'>For more information</h2>
<p>For more information on Rezolve, see <a href="http://rezolve.com">http://rezolve.com</a>.</p>
<h1 id='getting-started'>Getting Started</h1><h2 id='supported-os-versions'>Supported OS Versions</h2>
<table><thead>
<tr>
<th>OS</th>
<th>Minimum Version</th>
</tr>
</thead><tbody>
<tr>
<td>IOS</td>
<td>IOS 9 and up<br>SWIFT 4 (recommended) or 3</td>
</tr>
<tr>
<td>Android</td>
<td>4.2.2 and up</td>
</tr>
</tbody></table>
<h2 id='implement-a-crash-reporting-sytem'>Implement a Crash Reporting Sytem</h2>
<p>To provide quality support, we require quality information. </p>

<p>Rezolve advises using <strong><a href="https://fabric.io/kits/ios/crashlytics">Fabric Crashlytics</a></strong> to capture app problems on both IOS and Android.</p>

<p>We will not provide development support if you have not integrated Crashlytics or a similar tool.</p>
<h2 id='download-the-rezolve-insidetm-sdk-amp-get-an-api-key'>Download the Rezolve Inside<sup>TM</sup> SDK &amp; Get an API Key</h2><h3 id='request-api-key'><a href="license.html" target="_blank">Request API Key</a></h3>
<p>Latest release versions:</p>

<ul>
<li>Android: 2.1.0</li>
<li>IOS: 1.11.26</li>
</ul>

<p>If this is your first time downloading the SDK, you will be provided with an API Key and the required environment information to begin development.</p>
<h2 id='set-up-the-sdk-ios'>Set up the SDK - IOS</h2>
<p>The target IDE for IOS instructions is <strong>XCode</strong>. If you use a different IDE you may have to follow a different series of steps, please refer to your IDE documentation to understand how to incorporate third party SDKs into your IDE.</p>
<h3 id='cocoapods'>CocoaPods</h3>
<p>The Rezolve IOS SDK is distributed through <a href="https://cocoapods.org/about" target="_blank">CocoaPods</a>. In order to proceed with installing the SDK, as a prerequisite, first install the latest version of CocoaPods:</p>

<p><code>sudo gem install cocoapods</code></p>
<h3 id='install-rezolve-sdk'>Install Rezolve SDK</h3>
<p>The SDK can now be installed in your own project by adding the following in <code>Podfile</code>:</p>
<pre class="highlight swift tab-swift"><code><span class="n">use_frameworks</span><span class="o">!</span>

<span class="n">target</span> <span class="err">'</span><span class="kt">Sample</span><span class="err">'</span> <span class="k">do</span>
    <span class="n">pod</span> <span class="err">'</span><span class="kt">RezolveSDK</span><span class="err">'</span>
<span class="n">end</span>
</code></pre><h3 id='nbsp'>&nbsp;</h3>
<p>Keep in mind that Sample is just a placeholder, and should be substituted by your own App Target name. Now just run the following command on a Terminal window pointing to the directory of your Podfile:</p>

<p><code>pod install</code></p>

<p>Donâ€™t forget to use the <code>.xcworkspace</code> file to open your project in Xcode, instead of the <code>.xcodeproj</code> file, from here on out.</p>
<h4 id='updating-the-sdk'>Updating the SDK</h4>
<p>Every new release of the RezolveSDK can be updated by typing</p>

<p><code>pod update ResolveSDK</code></p>
<h2 id='set-up-the-sdk-android'>Set up the SDK - Android</h2>
<p>The target IDE for Android instructions is <strong>Android Studio</strong>. If you use a different IDE you may have to follow a different series of steps, please refer to your IDE documentation to understand how to incorporate third party SDKs into your IDE.</p>

<p>The Android SDK is distributed via the Rezolve Nexus/Maven repository. </p>
<h3 id='update-root-gradle-properties'>Update root gradle.properties</h3><pre class="highlight java tab-java"><code><span class="c1">// in /gradle.properties</span>
<span class="n">REZOLVE_SDK_REPOSITORY_URL</span><span class="o">=</span><span class="nl">https:</span><span class="c1">//nexus.rezo.lv/repository/maven-sdk-releases/</span>
<span class="n">REZOLVE_SDK_REPOSITORY_USERNAME</span><span class="o">=</span><span class="n">PUT_YOUR_USERNAME_HERE</span>
<span class="n">REZOLVE_SDK_REPOSITORY_PASSWORD</span><span class="o">=</span><span class="n">PUT_YOUR_PASSWORD_HERE</span>
</code></pre>
<p>Update the gradle.properties file in the root folder of your project and set variables for the repository url, username and repository password.  Your Nexus username and password will be assigned to you when you receive your API Key.</p>
<h3 id='update-root-build-gradle-to-add-repository'>Update root build.gradle to add repository</h3><pre class="highlight java tab-java"><code><span class="c1">// in /build.gradle</span>
<span class="n">allprojects</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">mavenLocal</span><span class="o">()</span>
        <span class="n">maven</span> <span class="o">{</span>
            <span class="n">url</span> <span class="n">REZOLVE_SDK_REPOSITORY_URL</span>
            <span class="n">credentials</span> <span class="o">{</span>
                <span class="n">username</span> <span class="n">REZOLVE_SDK_REPOSITORY_USERNAME</span>
                <span class="n">password</span> <span class="n">REZOLVE_SDK_REPOSITORY_PASSWORD</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">google</span><span class="o">()</span>
        <span class="n">jcenter</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Add the Rezolve repository to your root build.gradle file, in the <code>allprojects</code> block. </p>
<h3 id='update-app-module-build-gradle-to-add-sdk-dependency'>Update :app module build.gradle to add sdk dependency</h3><pre class="highlight java tab-java"><code><span class="c1">// in /app/build.gradle</span>
<span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">def</span> <span class="n">rezolveSdkVersion</span> <span class="o">=</span> <span class="s">"2.0.1"</span>
  <span class="n">implementation</span> <span class="s">"com.rezolve:sdk-android:$rezolveSdkVersion"</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre>
<p>Add Rezolve SDK dependency to build.gradle file in your :app module. Set the <code>rezolveSdkVersion</code> to the version you wish to use. Note it is important to use double quotes as shown around the implementation string, or <code>$rezolveSdkVersion</code> won&#39;t be evaluated. To upgrade to a new release, update <code>rezolveSdkVersion</code> to the latest version.</p>
<h3 id='permissions'>Permissions</h3><pre class="highlight java tab-java"><code><span class="c1">// Note: the SDK's manifest requests the following permissions:</span>
<span class="c1">// On Android 6.0+, you will have to specifically request the last two. </span>
<span class="c1">// See https://developer.android.com/training/permissions/requesting.html</span>

<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.INTERNET"</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.ACCESS_WIFI_STATE"</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.RECORD_AUDIO"</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">"android.permission.CAMERA"</span> <span class="o">/&gt;</span>

</code></pre>
          <h1 id='sdk-feature-use'>SDK Feature Use</h1>
<p>This section describes the usage of the SDK to build specific feature-related functionalities.</p>
<h2 id='android-specific-instructions-on-managers'>Android-specific instructions on Managers</h2><pre class="highlight java tab-java"><code>
<span class="c1">//  THE FOLLOWING TWO METHODS ARE EQUIVALENT, but Interface saves effort</span>

<span class="c1">//</span>
<span class="c1">// Using MANAGER, you must handle the response in a WalletCallback:</span>
<span class="c1">//</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="n">rezolveSDK</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
           <span class="o">.</span><span class="na">setApiKey</span><span class="o">(</span><span class="n">API_KEY</span><span class="o">)</span>
           <span class="o">.</span><span class="na">setEnv</span><span class="o">(</span><span class="n">ENVIRONMENT</span><span class="o">)</span>
           <span class="o">.</span><span class="na">setAuthRequestProvider</span><span class="o">(</span><span class="k">new</span> <span class="n">PartnerAuthRequestProvider</span><span class="o">(</span><span class="n">AuthService</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()))</span>
           <span class="o">.</span><span class="na">build</span><span class="o">();</span>

            <span class="n">rezolveSDK</span><span class="o">.</span><span class="na">setAuthToken</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>

            <span class="n">rezolveSDK</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span> <span class="n">accessToken</span><span class="o">,</span> <span class="n">entityId</span><span class="o">,</span> <span class="n">partnerId</span><span class="o">,</span> <span class="k">new</span> <span class="n">RezolveInterface</span><span class="o">()</span> <span class="o">{</span>


            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInitializationSuccess</span><span class="o">(</span><span class="n">RezolveSession</span> <span class="n">rezolveSession</span><span class="o">,</span> <span class="n">String</span> 
            <span class="n">entityId</span><span class="o">,</span> <span class="n">String</span> <span class="n">partnerId</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">rezolveSession</span><span class="o">.</span><span class="na">getWalletManager</span><span class="o">().</span><span class="na">getAll</span><span class="o">(</span><span class="k">new</span> <span class="n">WalletCallback</span><span class="o">()</span> <span class="o">{</span>

                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onWalletGetAllSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentCard</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>

                    <span class="c1">// handle getAll response here</span>
                        <span class="k">for</span><span class="o">(</span><span class="n">PaymentCard</span> <span class="n">paymentCard</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">String</span> <span class="n">cardId</span> <span class="o">=</span> <span class="n">paymentCard</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                            <span class="n">String</span> <span class="n">expiresOn</span> <span class="o">=</span> <span class="n">paymentCard</span><span class="o">.</span><span class="na">getExpiresOn</span><span class="o">();</span>
                            <span class="c1">// ...etc</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">});</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//</span>
<span class="c1">// Using INTERFACE, you can save some development time</span>
<span class="c1">//</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">WalletInterface</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// .getRezolveSession gets an already created session</span>
        <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getWalletManager</span><span class="o">().</span><span class="na">getAll</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onWalletGetAllSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentCard</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle getAll response here</span>
        <span class="k">for</span><span class="o">(</span><span class="n">PaymentCard</span> <span class="n">paymentCard</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">cardId</span> <span class="o">=</span> <span class="n">paymentCard</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">expiresOn</span> <span class="o">=</span> <span class="n">paymentCard</span><span class="o">.</span><span class="na">getExpiresOn</span><span class="o">();</span>
            <span class="c1">// ...etc</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>In the Android version of the Rezolve Inside<sup>TM</sup> SDK, each FeatureManager has an equivalent FeatureInterface.</p>

<p>For example, to use <code>WalletManager</code> methods, you can either do so directly, or implement <code>WalletInterface</code> in your current activity for convenience. See Android code at right for comparison.</p>

<p>The Module Reference section exclusively documents using Feature Interfaces, as this is the preferred method.</p>
<h2 id='automatic-thumbnail-generation'>Automatic thumbnail generation</h2>
<blockquote>
<p>Example JSON for 1 large image, and 4 associated &quot;thumbnail&quot; images</p>
</blockquote>
<pre class="highlight plaintext"><code>      "image": "https:\/\/s3.amazonaws.com\/1\/27\/Image.png",
      "image_thumbs": [
        "https:\/\/s3.amazonaws.com\/1\/27\/Image_thumb_400x550.png",
        "https:\/\/s3.amazonaws.com\/1\/27\/Image_thumb_800x1100.png",
        "https:\/\/s3.amazonaws.com\/1\/27\/Image_thumb_1200x1651.png",
        "https:\/\/s3.amazonaws.com\/1\/27\/Image_thumb_1600x2201.png"
      ],
</code></pre>
<p>When large images are uploaded to the merchant portal, the portal automatically generates a series of smaller images, which are referred to as thumbnails even though some are fairly large. The rules for thumbnail generation are as follows:</p>

<ul>
<li>Generated images respect the aspect ratio of the original image; their height/width ratio will not be distorted</li>
<li>If the uploaded image is: 

<ul>
<li>smaller or equal to 400px maximum dimension (width or height), no resized image is produced.</li>
<li>larger than 400px maximum dimension, it makes a 400px max dimension image. (referred to as the &quot;thumbnail&quot; image)</li>
<li>larger than 800px maximum dimension, it makes a 800px max dimension image, and all smaller sizes.</li>
<li>larger than 1200px maximum dimension, it makes a 1200px max dimension image, and all smaller sizes.</li>
<li>larger than 1600px maximum dimension, it makes a 1600px max dimension image, and all smaller sizes.</li>
</ul></li>
<li>Additionally, the original upload image always returned, even if gigantic. Consider if you need images larger than 1600x1600 in your app.</li>
<li>This applies to all merchant uploaded images that are supplied to the SDK. </li>
</ul>

<p>Each uploaded image will have a corresponding array of thumbnails. If an object can have an array of images, it will have an array of thumbnail arrays.</p>
<h2 id='user-management-introduction'>User Management Introduction</h2>
<p>For the purpose of the SDK, it is assumed the partner has an existing community of consumers, and has a method of authenticating them in the partner app. It is further assumed the partner wishes to introduce their consumers to Rezolve capabilities. Each partner consumer that wishes to utilize Rezolve services will need a Rezolve account.</p>

<p>The Rezolve SDK has no built-in authentication mechansim, but that is not to say there is no security. Rezolve is utilizing a server-to-server JWT authorization system, conformant with the <strong>https://tools.ietf.org/html/rfc7519</strong> standard. If you are not familar with JSON Web Tokens, the site <strong>https://jwt.io/</strong> provides an excellent primer on the use of JWTs, as well as links to various JWT libraries you can utilize.</p>

<p>Exactly how you implement authentication in your app will depend on what authorization system you use. You may either:</p>

<ul>
<li><p>Utilize an existing authentication server, and adapt it to serve the JWT required by Rezolve. This makes most sense if you already have a community of users with logins.</p></li>
<li><p>Utilize Rezolve User Authentication (RUA), our implementation of a JWT-aware auth system. If you do not have an existing auth system, adopting RUA may save development time, as opposed to implementing a new system from the ground up. Your Rezolve sales representative can help you with this decision.</p></li>
</ul>

<p>The primary task in implementing user management is to create the JWT that will allow you to bind a Partner user to a Rezolve profile. Through a server-to-server transaction, you can create a new Rezolve User Profile, and get back an identifying <code>entityId</code> that you should persist in your authentication database, as an addition to your user record. This <code>entityId</code> will then be used by the Rezolve SDK to identify the user to the Rezolve Server. </p>

<p>A valid JWT is required to initialize the SDK and start a sesssion. </p>
<h2 id='minimum-implementation'>Minimum Implementation</h2>
<p><strong>Topics</strong></p>

<ul>
<li><a href="#1-authentication">1. Authentication</a></li>
<li><a href="#2-profile-building-blocks">2. Profile Building Blocks</a></li>
<li><a href="#3-the-scan-interface">3. The Scan Interface</a></li>
<li><a href="4-checkout-and-payment">4. Checkout and Payment</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>

<p>As a developer, you may be thinking &quot;There is a lot of documentation here. What is the minimum feature set I need to implement to make a technical demo?&quot; </p>

<p>It depends on what you want to demonstrate, but the typical demonstration of Rezolve&#39;s offering looks like:</p>

<p><strong>Scan Engagement</strong>&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;&nbsp;<strong>View Product</strong>&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;&nbsp;&nbsp;<strong>Instant Buy</strong></p>

<p>This section walks you through the <em>minimum</em> implementation required to build a limited, functional, end-to-end demo. Several shortcuts are identified. These shortcuts are not appropriate for an app processing real transactions, but are acceptible for a technical demonstration on the Sandbox server. The shortcuts guide you to create a demo with limited UI elements, and only a single user. You are of course free to implement as many of the features as you wish to demonstrate. </p>
<h3 id='1-authentication'>1. Authentication</h3>
<p>Two things must be in place before the SDK can communicate with the server</p>

<ol>
<li>You must have an <code>API Key</code> and <code>Partner Id</code>, and be must talking to the correct <code>Environment</code>.  This information was provided to you when you signed up for API Access.</li>
<li>You must have a valid <code>JSON Web Token</code>, or <code>JWT</code>. A <code>JWT Secret</code> was provided when you signed up for API Access, and is used to create the <code>JWT</code>. </li>
</ol>

<p>Examples of both authenticaton measures are shown under <strong><a href="#jwt-authentication">JWT Authentication</a></strong> .</p>

<aside class="notice">

<b>Shortcut</b>

<p>New developers sometimes get stuck on #2, JWT Authentication, as it is somewhat complex and requires a server-to-server integration. For a technical trial, instead of modifying your auth server, you can take a partial shortcut:

<p>At <a href="#create-the-registration-jwt">Create the Registration JWT</a>, there are links to an online JWT debugger, epoch converter, and a zip file. The zip file contains screenshots showing how to use these tools in conjunction with <a href="https://www.getpostman.com/" target="_blank">Postman</a> to manually create and use JSON Web Tokens.  You must create the <code>Registration JWT</code>, and then create the <code>Login JWT</code>, as documented and get your <code>entity_id</code>.  But when creating the <code>Login JWT</code>, create one with an expiration date well in the future, 6 months from the current date.  You can then use this <code>JWT</code> and the corresponding <code>entity_id</code> in your code while you test. This frees you from doing full auth server integration for a simple technical trial.

</aside>

<p>Be aware this is UNSAFE for production, or even pilot use. For any rollout involving real consumers and real purchases, you must do the auth server integration, so JWT tokens are tied properly to login status for a single user, and tokens can be renewed and expired.</p>
<h3 id='2-profile-building-blocks'>2. Profile Building Blocks</h3>
<p>The end consumer is represented by a Profile. Attached to this profile are one or more addresses, one or more phone numbers, and one or more payment devices. To create these objects, you must implement:</p>

<ul>
<li><code>ConsumerProfileManager</code> - and create a profile record</li>
<li><code>AddressbookManager</code> - and create an address record</li>
<li><code>PhonebookManager</code> - and create a phone record.</li>
<li><code>WalletManager</code> - and add a credit card. (we recommend using VISA <code>4111 1111 1111 1111</code> for testing)</li>
</ul>

<p>During the scan and purchase flow, ids for profile, address, phone, and payment device will be needed. You will get these by querying the above managers to get to get the ids of the records you created.</p>

<p>See <strong><a href="#consumer-profile-management">Consumer Profile Management</a></strong>. </p>

<aside class="notice">

<b>Shortcut</b>

<p>Normally, you would create a UI for each of these managers, allowing the consumer to enter their information.

<p>For a technical demo, you might forgo creating an UI.  Instead, after authentication, to a GET to each manager, and if incomplete or null results are returned, create the needed record from hard coded data. 

</aside>
<h3 id='3-the-scan-interface'>3. The Scan Interface</h3>
<p>You must implement <code>ScanManager</code>, and all it&#39;s methods. </p>

<p>You will also need <code>ProductManager</code>, to get and parse the retrieved product. </p>

<p>See the example at <strong><a href="#product-scan-instant-buy-flow">Product Scan, Instant Buy Flow</a></strong>.</p>
<h3 id='4-checkout-and-payment'>4. Checkout and Payment</h3>
<p>Checkout and payment rely upon the following managers. </p>

<ul>
<li><code>PaymentOptionsManager</code></li>
<li><code>CheckoutManagerV2</code> </li>
</ul>

<p>You must at least stub all the methods of these managers. But you may notice there are some methods specific to cart, and some specific to product. For instant buy, you only need to fully implement the PRODUCT methods. </p>

<aside class="notice">

<b>Shortcut</b>

<p>It is recommended you display full product info after the scan, and implement a slide-to-buy control to make the purchase. However, you might skip the interactive UI where the consumer would normally choose quantity, shipping address, and payment card, and have these choices hard coded instead. 

<p>Note that a simple product requires only a choice of quantity, so these are easiest to make a demo with.

</aside>

<p>See the example at <strong><a href="#product-scan-instant-buy-flow">Product Scan, Instant Buy Flow</a></strong>.</p>
<h3 id='conclusion'>Conclusion</h3>
<p>The above steps outline the absolute shortest route to a fully functional tech demonstraton. Please follow them, and embrace the shortcuts provided, to create your tech demo in the minimal time. </p>

<p>But be aware that the Minimum Implementation is suitable for a Technical Demo only. Any application that will be given to consumers and used to make real purchases must fully implement JWT Auth, a proper Consumer UI, and included features omitted from this section, like Mall, Shopping Cart, Multi-Cart, and more.  </p>

<p>The <a href="#reference-app">Rezolve Reference App</a> is a great example of a full-featured implementation. If haven&#39;t used it yet, request access and give it a try.  </p>

          <h2 id='jwt-authentication'>JWT Authentication</h2>
<p><strong>Topics</strong></p>

<ul>
<li><a href="#terminology">Terminology</a></li>
<li><a href="#jwt-flow">JWT Flow</a></li>
<li><a href="#create-the-registration-jwt">Create the Registration JWT</a></li>
<li><a href="#register-a-new-rezolve-user">Register a new Rezolve User</a></li>
<li><a href="#logging-in-a-user">Logging in a User</a></li>
<li><a href="#handling-jwt-expiration-amp-session-preservation">Handling JWT Expiration &amp; Session Preservation</a></li>
<li><a href="#http-error-responses">HTTP Error Responses</a></li>
</ul>

<p>As of release 1.6.0, the Rezolve SDK no longer includes an authentication system. Resultingly, the <code>AuthenticationManager.register</code> and <code>AuthenticationManager.logout</code>  methods have been deprecated.</p>

<p>Instead, Rezolve is utilizing a server-to-server JWT authentication system, conformant with the <strong>https://tools.ietf.org/html/rfc7519</strong> standard. If you are not familar with JSON Web Tokens, the site <strong>https://jwt.io/</strong> provides an excellent primer on the use of JWTs, as well as links to various JWT libraries you can utilize.</p>

<p>Rezolve expects the primary authentication of users will happen outside the SDK. Thus, exactly how you implement authentication in your app will depend on your existing auth system. In the server-to-server realm, however, there is only one instance in which your authentication server must interact with the Rezolve server. </p>

<p>After that, whether or not the SDK can talk to Rezolve depends on supplying a valid JWT to the SDK from your auth system.</p>

<p>When the Partner creates a new user on their auth server, or wishes to associate an existing user with Rezolve for the first time, the partner must generate the Registration JWT, and then POST it to the <code>/api/v1/authentication/register</code> endpoint. The Rezolve server will validate the JWT, create a new user, create the user&#39;s public/private key pair, and return to you the Rezolve EntityId. </p>

<p>When a user logs in to your auth system, generate a new Login JWT and supply to CreateSession in the SDK. As long as the JWT is valid, the SDK can talk to Rezolve. A method is suggested below for smoothly handling JWT timeouts without interrupting the SDK session. </p>
<h3 id='terminology'>Terminology</h3>
<table><thead>
<tr>
<th>Term</th>
<th>Definition</th>
</tr>
</thead><tbody>
<tr>
<td>partner_id</td>
<td>A numerical id you are assigned by Rezolve. Usually a 2-4 digit integer.</td>
</tr>
<tr>
<td>partner_api_key</td>
<td>The API key you are assigned by Rezolve. 36 characters including dashes.</td>
</tr>
<tr>
<td>partner_auth_key</td>
<td>The Auth key you are assigned by Rezolve. This plays the role of the JWT Secret. The partner_auth_key is typically a ~90 character hash.</td>
</tr>
<tr>
<td>JWT token</td>
<td>A JSON Web Token, consisting of a header, payload, and signature. The header and signature are signed with the parther_auth_key, above. It is used as a bearer token when communicating with the Rezolve server.</td>
</tr>
<tr>
<td>accessToken</td>
<td>In the IOS and Android code samples, the accessToken is the JWT Token you generated.</td>
</tr>
<tr>
<td>deviceId</td>
<td>An id that is randomly generated upon app install and stored. This id is placed in both the JWT payload and x-header sent by the SDK. The Rezolve server checks that these values match to deter request origin spoofing. All calls except Registration calls require this.</td>
</tr>
</tbody></table>
<h3 id='jwt-flow'>JWT Flow</h3>
<p><img src="images/wsd-jwt-flow.png" style="margin:6px 0;"><br/>[ <a href="images/wsd-jwt-flow.png" target="_blank">View full size</a> ]</p>
<h3 id='create-the-registration-jwt'>Create the Registration JWT</h3>
<aside class="notice">
**Note:**

For testing via cURL or Postman without a server-side JWT library, you can use <a href="https://jwt.io/#debugger" target="_blank">https://jwt.io/#debugger</a> to generate valid JWT tokens. <br><br>Use <a href="https://www.epochconverter.com/" target="_blank">https://www.epochconverter.com/</a> to generate the token expiration in Epoch time. <br><br><a href="images/postman-example.zip">Click here for screenshots showing registration using jwt.io and Postman.</a>
</aside>
<h4 id='requirements'>Requirements</h4>
<p>You must possess:</p>

<table><thead>
<tr>
<th>field</th>
<th>description</th>
<th>example</th>
</tr>
</thead><tbody>
<tr>
<td>partner_id</td>
<td>The numerical id you are assigned by Rezolve</td>
<td>317</td>
</tr>
<tr>
<td>partner_api_key</td>
<td>The API key you are assigned by Rezolve</td>
<td>a1b2c3d4-e5f6-g7h8-i9j0-a1b2c3d4e5f6</td>
</tr>
<tr>
<td>partner_auth_key</td>
<td>The Auth key you are assigned by Rezolve</td>
<td>qwer+4ty ... JYG6XavJg== (approx 90 characters)</td>
</tr>
</tbody></table>
<h4 id='jwt-header'>JWT Header</h4><pre class="highlight plaintext"><code>{
    "alg": "HS512",
    "typ": "JWT"
}
</code></pre>
<table><thead>
<tr>
<th>key</th>
<th>value</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>alg</td>
<td>HS512</td>
<td>algorithm, HMAC SHA-512</td>
</tr>
<tr>
<td>typ</td>
<td>JWT</td>
<td>type</td>
</tr>
</tbody></table>
<h4 id='jwt-payload'>JWT Payload</h4><pre class="highlight plaintext"><code>{
    "rezolve_entity_id": ":NONE:",
    "partner_entity_id": "partner_entity_id",
    "exp": 1520869470
}
</code></pre>
<table><thead>
<tr>
<th>key</th>
<th>value</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>rezolve_entity_id</td>
<td>:NONE:</td>
<td>use :NONE: when registering</td>
</tr>
<tr>
<td>partner_entity_id</td>
<td>your_user_id</td>
<td>The unique identifier for your user record. This may be a numerical id, or an identifying string such as email address.</td>
</tr>
<tr>
<td>exp</td>
<td>1520869470</td>
<td>Expiration, as a unix timestamp integer. Set the expiration value to a small number, now() + 30 minutes or less.</td>
</tr>
</tbody></table>
<h4 id='signature'>Signature</h4><pre class="highlight plaintext"><code>HMACSHA512(
    base64UrlEncode(header) + "." +
    base64UrlEncode(payload),
    ${$partner_auth_key}
)
</code></pre>
<p>Sign the header and payload with the <code>partner_auth_key</code>.  It is not necessary to decode the key before using it. Pass the whole value as a string to your library&#39;s <code>getBytes</code> method.  </p>

<p>You may need to specify the charset as UTF8. 
Example 1, Microsoft: <code>SecretKey(Encoding.UTF8.GetBytes(key));</code><br>
Example 2, Java:  <code>Secret.getBytes(&quot;UTF-8&quot;);</code></p>
<pre class="highlight plaintext"><code>eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.
eyJyZXpvbHZlX2VudGl0eV9pZCI6IjpOT05FOiIsInBhcnRuZXJfZW50aXR5X2lkIjoiMTIzIiwiZXhwIjoxNTIwODY5NDcwfQ.
5y2e6QpUKcqTNLTv75nO6a6iFPVxrF8YeAH5NTg2ZO9dkub31GEs0N46Hu2IJf1bQ_vC2IOO9Z2N7drmvA_AKg
</code></pre>
<p>The resulting JWT will look something like this (except without linebreaks); the first third is the header, the second third the payload, and the last third the signature: </p>
<h3 id='register-a-new-rezolve-user'>Register a new Rezolve User</h3><pre class="highlight plaintext"><code>POST: https://sandbox-api-tw.rzlvtest.co/api/v1/authentication/register
-H content-type: application/json
-H x-rezolve-partner-apikey: your-api-key
-H authorization: Bearer signed-jwt
-d {
"email": "user@example.com"
}
</code></pre>
<p>After the JWT is created, POST it to the Rezolve registration endpoint. This will create a Rezolve User, generate a public/private keypair for the user, and return to you the corresponding Entity Id. </p>

<p>Example, using Sandbox endpoint: </p>
<pre class="highlight plaintext"><code>{
    "entity_id" : "entity123",
    "partner_id" : "3"
}
</code></pre>
<p>The endpoint will reply with an entity id and the partner id. You should save the Rezolve Entity Id to your authentication database and associate it with the user&#39;s record.</p>
<h3 id='logging-in-a-user'>Logging in a User</h3>
<p>Once a Rezolve User has been registered and an <code>entity_id</code> obtained, you can log in the user using the instructions below. </p>

<p>For returning users, log them in via your normal method in your auth server, and then follow the instructions below.</p>

<p>Create a new <code>Login JWT</code>, and use it as the <code>accessToken</code> in the <code>createSession</code> method.</p>
<h4 id='jwt-header-2'>JWT Header</h4>
<p>Note the addition of the &quot;auth&quot; line.</p>
<pre class="highlight plaintext"><code>{
    "auth": "v2",
    "alg": "HS512",
    "typ": "JWT"
}
</code></pre>
<table><thead>
<tr>
<th>key</th>
<th>value</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>auth</td>
<td>v2</td>
<td>auth version to use, login uses v2</td>
</tr>
<tr>
<td>alg</td>
<td>HS512</td>
<td>algorithm, HMAC SHA-512</td>
</tr>
<tr>
<td>typ</td>
<td>JWT</td>
<td>type</td>
</tr>
</tbody></table>
<h4 id='jwt-payload-2'>JWT Payload</h4>
<p>Note the addition of the <code>device_id</code>.</p>
<pre class="highlight plaintext"><code>{
    "rezolve_entity_id": "entity123",
    "partner_entity_id": "partner_entity_id",
    "exp": 1520869470, 
    "device_id": "wlkCDA2Hy/CfMqVAShslBAR/0sAiuRIUm5jOg0a"
}
</code></pre>
<table><thead>
<tr>
<th>key</th>
<th>value</th>
<th>notes</th>
</tr>
</thead><tbody>
<tr>
<td>rezolve_entity_id</td>
<td>your_rezolve_entity_id</td>
<td>use the entity_id you obtained during registration</td>
</tr>
<tr>
<td>partner_entity_id</td>
<td>your_partner_entity_id</td>
<td>set it to the unique identifier for your user record</td>
</tr>
<tr>
<td>exp</td>
<td>1520869470</td>
<td>Expiration, as a unix timestamp integer. Set the expiration value to a small number, now() + 30 minutes or less.</td>
</tr>
<tr>
<td>device_id</td>
<td>wlkCDA2Hy/CfMqVAShslBAR/0sAiuRIUm5jOg0a</td>
<td>An id randomly generated upon app installation and stored. This id is placed in both the JWT payload and x-header sent by the SDK. See below for generation instructions.</td>
</tr>
</tbody></table>
<h4 id='signature-2'>Signature</h4><pre class="highlight plaintext"><code>HMACSHA512(
    base64UrlEncode(header) + "." +
    base64UrlEncode(payload),
    ${$partner_auth_key}
)
</code></pre>
<p>Sign the header and payload with the <code>partner_auth_key</code>.</p>
<h4 id='generating-the-device_id'>Generating the device_id</h4><pre class="highlight swift tab-swift"><code><span class="c1">// IOS uses the IOS "identifierForVendor" string, so there is no need to generate it. </span>
<span class="c1">// The IOS SDK pulls this value automatically using `UIDevice.current.identifierForVendor?.uuidString` and supplies it to the SDK for the x-header.</span>
<span class="c1">// You will need to use this same call to supply the device_id to your auth server for storage with the user profile.</span>

<span class="kt">UIDevice</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">identifierForVendor</span><span class="p">?</span><span class="o">.</span><span class="n">uuidString</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// generate the random id</span>
<span class="n">String</span> <span class="n">deviceId</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

<span class="c1">// store the device_id</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeDeviceIdFile</span><span class="o">(</span><span class="n">File</span> <span class="n">deviceidfile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">FileOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">deviceidfile</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// read the stored device_id</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">readDeviceIdFile</span><span class="o">(</span><span class="n">File</span> <span class="n">deviceidfile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">RandomAccessFile</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomAccessFile</span><span class="o">(</span><span class="n">deviceidfile</span><span class="o">,</span> <span class="s">"r"</span><span class="o">);</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="n">f</span><span class="o">.</span><span class="na">length</span><span class="o">()];</span>
    <span class="n">f</span><span class="o">.</span><span class="na">readFully</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
    <span class="n">f</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// supply the random id to the SDK</span>
<span class="n">RezolveSDK</span><span class="o">.</span><span class="na">setDeviceIdHeader</span><span class="o">(</span><span class="n">deviceId</span><span class="o">);</span>

</code></pre>
<p>To generate and set the device_id, see the OS specific examples to the right. On IOS it is handled automatically using <code>identifierForVendor?.uuidString</code>.  Android must manually generate, store, read, and pass the <code>device_id</code> to the SDK. </p>
<h4 id='create-the-session'>Create the Session</h4>
<p>In the samples to the right, <code>accessToken</code> is the Login JWT token you created above. </p>

<p>Note in the Android sample you are also passing in an AuthRequestProvider. This is used for handling expiring JWT sessions, and is explained in the next section.</p>
<pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>


<span class="kd">class</span> <span class="kt">SandboxViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">API_KEY</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"your_api_key"</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">API_ENVIRONMENT</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"sandbox-api-tw.rzlvtest.co"</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">accessToken</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"abc123.abc123.abc123"</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">entityId</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"123"</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">partnerId</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"123"</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">var</span> <span class="nv">sdk</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span>
            <span class="nv">apiKey</span><span class="p">:</span> <span class="kt">API_KEY</span><span class="p">,</span>
            <span class="nv">env</span><span class="p">:</span> <span class="kt">API_ENVIRONMENT</span>
        <span class="p">)</span>

        <span class="n">sdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span><span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="p">,</span> <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">)</span> <span class="p">{</span> <span class="n">session</span>

            <span class="c1">// your rezolve SDK logic here</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre><pre class="highlight java tab-java"><code><span class="n">String</span> <span class="n">API_KEY</span> <span class="o">=</span> <span class="s">"your_api_key"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">ENVIRONMENT</span> <span class="o">=</span> <span class="s">"https://sandbox-api-tw.rzlvtest.co/api"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="s">"abc123.abc123.abc123"</span><span class="o">;</span>  <span class="c1">// JWT token from auth server</span>
<span class="n">String</span> <span class="n">entityId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>    <span class="c1">// from auth server</span>
<span class="n">String</span> <span class="n">partnerId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>   <span class="c1">// from auth server</span>
<span class="n">String</span> <span class="n">deviceId</span> <span class="o">=</span> <span class="s">"wlkCDA2Hy/CfMqVAShslBAR/0sAiuRIUm5jOg0a"</span><span class="o">;</span> <span class="c1">// from stored device_id, see "Generating the device_id" above</span>

<span class="c1">// Use builder to create instance of SDK and set SDK Params</span>
<span class="c1">// Pass in an AuthRequestProvider here, to handle expiring JWT tokens</span>
<span class="n">rezolveSDK</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
               <span class="o">.</span><span class="na">setApiKey</span><span class="o">(</span><span class="n">API_KEY</span><span class="o">)</span>
               <span class="o">.</span><span class="na">setEnv</span><span class="o">(</span><span class="n">ENVIRONMENT</span><span class="o">)</span>
               <span class="o">.</span><span class="na">setAuthRequestProvider</span><span class="o">(</span><span class="k">new</span> <span class="n">PartnerAuthRequestProvider</span><span class="o">(</span><span class="n">AuthService</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()))</span>
               <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Set JWT Auth Token from partner auth server</span>
<span class="n">rezolveSDK</span><span class="o">.</span><span class="na">setAuthToken</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>

<span class="c1">// Start session, again supplying JWT auth token</span>
<span class="n">rezolveSDK</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span> <span class="n">accessToken</span><span class="o">,</span> <span class="n">entityId</span><span class="o">,</span> <span class="n">partnerId</span><span class="o">,</span> <span class="k">new</span> <span class="n">RezolveInterface</span><span class="o">()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInitializationSuccess</span><span class="o">(</span><span class="n">RezolveSession</span> <span class="n">rezolveSession</span><span class="o">,</span> <span class="n">String</span> <span class="n">entityId</span><span class="o">,</span> <span class="n">String</span> <span class="n">partnerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// set device_id so it can be passed in x-header</span>
        <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">setDeviceIdHeader</span><span class="o">(</span><span class="n">deviceId</span><span class="o">);</span>

        <span class="c1">// use created session to access managers.  Example...</span>
        <span class="n">rezolveSession</span><span class="o">.</span><span class="na">getAddressbookManager</span><span class="o">().</span><span class="na">get</span><span class="o">(...);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInitializationFailure</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// handle error</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre><h3 id='handling-jwt-expiration-amp-session-preservation'>Handling JWT Expiration &amp; Session Preservation</h3><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">RezolveSDK</span>
<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">internal</span> <span class="kd">enum</span> <span class="kt">Result</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">success</span><span class="p">(</span><span class="kt">T</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">failure</span><span class="p">(</span><span class="kt">HttpResponse</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">internal</span> <span class="kd">protocol</span> <span class="kt">TokenRenewProtocol</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">renewToken</span><span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">RezolveSession</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">internal</span> <span class="kd">class</span> <span class="kt">AuthService</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">TokenRenewProtocol</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">renewToken</span><span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">RezolveSession</span><span class="p">,</span> <span class="kt">AuthenticationError</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">urlString</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">let</span> <span class="nv">endpoint</span> <span class="o">=</span> <span class="s">"/api/v1/authentication/register"</span>
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="p">[</span><span class="s">"username"</span><span class="p">:</span> <span class="s">"user@email.com"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">]</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">urlString</span><span class="p">)</span><span class="o">.</span><span class="nf">appendPathComponent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">),</span>
              <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"Url not created, verify check path and host"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">device</span><span class="p">:</span> <span class="kt">DeviceProfile</span>  <span class="o">=</span> <span class="o">...</span> <span class="c1">// The device profile </span>
        <span class="k">let</span> <span class="nv">entityId</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span>  <span class="o">...</span> <span class="c1">// Entity Id</span>
        <span class="k">let</span> <span class="nv">partnerId</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// Partner Id</span>

        <span class="k">let</span> <span class="nv">dictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">String</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">"device_id"</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">deviceId</span><span class="p">,</span>
            <span class="s">"make"</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">make</span><span class="p">,</span>
            <span class="s">"os_type"</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">osType</span><span class="p">,</span>
            <span class="s">"os_version"</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">osVersion</span><span class="p">,</span>
            <span class="s">"locale"</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">locale</span>
            <span class="s">"entityId"</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span>
            <span class="s">"partnerId"</span><span class="p">:</span> <span class="n">partnerId</span>
        <span class="p">]</span>

        <span class="k">guard</span> <span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">withJSONObject</span><span class="p">:</span> <span class="n">dictionary</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">preconditionFailure</span><span class="p">(</span><span class="s">"Payload convertion to Data failed"</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">request</span><span class="o">.</span><span class="n">httpMethod</span> <span class="o">=</span> <span class="s">"POST"</span>
        <span class="n">request</span><span class="o">.</span><span class="n">httpBody</span> <span class="o">=</span> <span class="n">body</span>


        <span class="k">let</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
        <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">urlRequest</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
                    <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="k">let</span> <span class="nv">responseData</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                       <span class="k">let</span> <span class="nv">jsonDictionary</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">responseData</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
                        <span class="k">let</span> <span class="nv">accessToken</span> <span class="o">=</span> <span class="n">jsonDictionary</span><span class="p">[</span><span class="s">"access_token"</span><span class="p">]</span>
                        <span class="k">let</span> <span class="nv">publicKey</span> <span class="o">=</span>   <span class="n">jsonDictionary</span><span class="p">[</span><span class="s">"public_key"</span><span class="p">]</span>
                        <span class="c1">// Securily store received keys</span>
                        <span class="c1">// Create new session with received accessToken</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">rezolveSdk</span><span class="p">?</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
                            <span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="p">,</span>
                            <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span>
                            <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
                            <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">rezolveSession</span> <span class="k">in</span>
                                <span class="c1">// Store new token</span>

                                <span class="c1">// Proccess callback</span>
                                <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">rezolveSession</span><span class="p">))</span>
                        <span class="p">},</span>  <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
                                <span class="c1">// Error handling</span>

                                <span class="c1">// Proccess callback</span>
                                <span class="nf">callback</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                        <span class="p">})</span>
                       <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// Handle parsing error</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// Handle error</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">internal</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">AddressBookViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="nf">fileprivate</span><span class="p">(</span><span class="k">set</span><span class="p">)</span> <span class="k">var</span> <span class="nv">authService</span><span class="p">:</span> <span class="p">(</span><span class="kt">NSObjectProtocol</span> <span class="o">&amp;</span> <span class="kt">TokenRenewProtocol</span><span class="p">)?</span>

    <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">attemptToGetAddressBook</span><span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">,</span> <span class="nv">retryOnFail</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">session</span><span class="o">.</span><span class="n">addressbookManager</span><span class="o">.</span><span class="nf">getAll</span><span class="p">(</span><span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">addressList</span> <span class="k">in</span>
            <span class="c1">// Handle addressList</span>

            <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">httpResponse</span> <span class="k">in</span>
                <span class="k">if</span> <span class="n">retryOnFail</span> <span class="o">&amp;&amp;</span> <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">401</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">authService</span><span class="p">?</span><span class="o">.</span><span class="n">renewToken</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
                        <span class="n">swith</span> <span class="n">result</span> <span class="p">{</span>
                            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">newSession</span><span class="p">):</span>
                                <span class="c1">// Retries to fetch data from AddressBookManager using the new RezolveSession</span>
                                <span class="k">self</span><span class="o">.</span><span class="nf">attemptToGetAddressBook</span><span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="n">newSession</span><span class="p">,</span> <span class="nv">retryOnFail</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>

                            <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
                                <span class="c1">// Handle Token Renewal failure</span>
                                <span class="nf">debugPrint</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// example Partner Auth Request Provider </span>
<span class="c1">// this would handle partner user login against partner server, password reset,</span>
<span class="c1">// as well as JWT token renewal</span>
<span class="kd">class</span> <span class="nc">PartnerAuthRequestProvider</span> <span class="kd">implements</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">AuthRequestProvider</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AuthService</span> <span class="n">authService</span><span class="o">;</span>
    <span class="n">RuaAuthRequestProvider</span><span class="o">(</span><span class="n">AuthService</span> <span class="n">authService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span> <span class="n">authService</span> <span class="o">=</span> <span class="n">authService</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">GetAuthRequest</span> <span class="nf">getAuthRequest</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">()</span> <span class="o">==</span> <span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">"You can't run this method from main thread"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//set blocking call as the refresh token callback</span>
        <span class="kd">final</span> <span class="n">RefreshTokenCallbackToBlockingCall</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RefreshTokenCallbackToBlockingCall</span><span class="o">();</span>
        <span class="n">authService</span><span class="o">.</span><span class="na">refreshAuthToken</span><span class="o">(</span><span class="n">callback</span><span class="o">);</span>

        <span class="c1">// ping the partner auth service</span>
        <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">GetAuthRequest</span> <span class="n">authRequest</span> <span class="o">=</span> <span class="n">PartnerPingCallbackToBlockingCall</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">authRequest</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">RefreshTokenCallbackToBlockingCall</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">GetAuthRequest</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

    <span class="c1">// on successful refresh, wait for the ping response </span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRefreshAuthTokenSuccess</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">String</span> <span class="n">authToken</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">GetAuthRequest</span><span class="o">.</span><span class="na">authorizationHeader</span><span class="o">(</span><span class="n">authToken</span><span class="o">);</span>
        <span class="n">countDownLatch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// getResult is only triggered after a result is received from the partner auth server</span>
    <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">GetAuthRequest</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">countDownLatch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle the exception</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>The Login JWT you generate is included in the headers of every SDK transmission. Thus, when your consumer logs out, you can expire the JWT, and the app will cease communication with the Rezolve server. To do this, create a new JWT with an expiration stamp in the past, and supply it to the SDK.</p>

<p>This also means you are required to handle JWT token expiration/renewal if you want a session to continue. </p>

<p>Examples are provided to the right. These are NOT an example of implementing SDK code, but rather an example of implementing session rewnewal with your own authentication server. </p>

<p><strong>IOS</strong></p>

<p>To handle session expiration smoothly, without interrupting the user session, Rezolve recommends creating a wrapper around any call that contacts the server. If the server returns an authorization error, you can call your token renewal endpoint and issue a new JWT. </p>

<p>The sample shows two classes, an <code>AuthService</code> class and an <code>AddressBookViewController</code> class. </p>

<p>The <code>AuthService</code> class may, for example, process username/passwords for login, handle registering your users, and handle password resets.  It should also handle the JSON Web Tokens to register, create session, and maintain session with Rezolve. The example method <code>renewJwtToken</code> is provided as an example of how to renew a token. </p>

<p>The <code>AddressBookViewController</code> is an example of how you would implement the <code>AddressbookManager.getAll</code> method so as to smoothly handle token expiration and renewal to provide continuity of session. </p>

<ol>
<li>call the method <code>attemptToGetAddressBook</code> passing in a Rezolve session and the <code>retryOnFail</code> boolean</li>
<li>the method calls the <code>addressbookManager.getAll</code> method</li>
<li>if the call succeeds, proceed as normal, displaying the <code>addressList</code></li>
<li>if the call results in an error, check if the error is a 401.</li>
<li>If the error is a 401, and the <code>retryOnFail</code> is true, request a new JWT, calling the <code>renewJwtToken</code> method. Then retry the request.</li>
<li>If the error is 401, and <code>retryOnFail</code> is false, we know that we requested a new token and the token provided was expired (indicating end of login session at auth server). Do not retry.</li>
<li>If a different error occurs, log and handle the error.</li>
</ol>

<p><strong>Android</strong></p>

<p>The SDK makes every call to the Rezolve server using an http client; if a call to the server results in a &quot;401 token expired&quot; response, the http client will ask for a new token using <code>RezolveSDK.AuthRequestProvider</code>. The Partner Auth Service you passed in to the SDK Builder must handle this JWT renewal.</p>

<p>It should be noted that the Partner Auth Service will typically handle all partner auth needs. Duties may include processesing username/passwords for login, handling registering your users, and handling password resets, in addition to JWT renewal. </p>

<p>The code examples show one way of implementing JWT renewal. </p>

<p>In the class <code>PartnerAuthRequestProvider</code> the Partner Auth Service implements <code>RezolveSDK.AuthRequestProvider</code>, to handle the JWT renewal requirements of the SDK. If the http client receives a &quot;401 token expired&quot;, it will call <code>RezolveSDK.GetAuthRequest</code> to either confirm logout or renew the token. The token is renewed, but is only returned if the ping to the partner auth server to check login status suceededs. If the partner auth server says the user is not logged in, the renewed token is not returned, and the user can no longer make requests. If the user is still logged in, the updated JWT is returned.</p>
<h3 id='http-error-responses'>HTTP Error Responses</h3><h4 id='403'>403</h4><pre class="highlight plaintext"><code>{
    "type": "Authentication"
    "code": "1"
    "message": "Access is denied."
}
</code></pre>
<p>For security reasons, Rezolve masks certain potential issues behind a generic 403 response:</p>

<ul>
<li>invalid partner api key</li>
<li>partner doesn&#39;t have an auth key</li>
<li>token not found</li>
<li>invalid token signature</li>
<li>token is missing required fields</li>
<li>token belongs to another user</li>
</ul>
<h4 id='401'>401</h4><pre class="highlight plaintext"><code>{
    "type": "Expired Token"
    "code": "8"
    "message": "Your token has expired, refresh your token and try again."
}
</code></pre>
<p>If you receive this response, call your JWT renewal endpoint. </p>

          <h2 id='consumer-profile-management'>Consumer Profile Management</h2>
<p>Once you have established a session, you have access to the consumer&#39;s records. These include:</p>

<ul>
<li>Consumer Profile - Via the <code>ConsumerProfileManager</code>. Name, email, and device profile (phone info) for the consumer</li>
<li>Address Book - Via the <code>AddressbookManager</code>. A collection of postal addresses, to be used for ship-to and bill-to purposes.</li>
<li>Phone Book - Via the <code>PhonebookManager</code>. A collection of phone numbers associated with the profile. </li>
<li>Favorites - Via the <code>FavouriteManager</code>. Reserved for future functionality, &quot;Favorites&quot; are collections of unique devices that can be topped up.  A favorite can represent a mobile phone, a tollway transponder, or other device/account.</li>
<li>Wallet - Via the <code>WalletManager</code>. Wallet lets you store credit card info securely, and lets the consumer maintain the list of cards. There can be multiple cards.</li>
</ul>

<p>There are no specific flows to consider when managing the customer profile and associated records.</p>

<p>AddressbookManager, FavouriteManager, PhonebookManager and WalletManager support the following CRUD operations: <code>create</code>, <code>update</code>, <code>delete</code>, <code>getAll</code>, <code>get</code>.</p>

<p>ProfileManager supports only <code>update</code> and <code>get</code>.</p>

          <h2 id='product-scan-instant-buy-flow'>Product Scan, Instant Buy flow</h2>
<p><img src="images/wsd-jwt-product-buy-flow.png" style="margin:6px 0;"><br/>[ <a href="images/JWT-shoppable-ad-flow-single-buy.png" target="_blank">View full size</a> ]</p>

<p>The premise of Shoppable Ads is to capture an image scan (usually of an advertisement) using the Scan Manager, resolve it into a product URL, fetch the product info, and enable purchase via saved account information.</p>

<p>In the Instant Buy flow, we purchase the product immediately, without first adding it to the cart.</p>
<h4 id='1-capture-image-and-get-product'>1. Capture image and get product</h4><pre class="highlight swift tab-swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">ProductDelegate</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// Initialize RezolveSDK</span>
            <span class="k">let</span> <span class="nv">rezolveSdk</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span>
                <span class="nv">apiKey</span><span class="p">:</span> <span class="kt">REZOLVE_API_KEY</span><span class="p">,</span> 
                <span class="nv">env</span><span class="p">:</span> <span class="kt">REZOLVE_SDK_ENV</span><span class="p">,</span> 
                <span class="nv">config</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> 
                <span class="nv">dataClient</span><span class="p">:</span> <span class="n">dataClient</span>
            <span class="p">)</span>

            <span class="c1">// Creates Session</span>
            <span class="n">rezolveSdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
                <span class="nv">accessToken</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> 
                <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> 
                <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
                <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">session</span> <span class="k">in</span>

                    <span class="k">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="n">productResultDelegate</span> <span class="o">=</span> <span class="k">self</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="nf">startVideoScan</span><span class="p">(</span><span class="nv">scanCameraView</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="k">as!</span> <span class="kt">ScanCameraView</span><span class="p">)</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">401</span> <span class="p">{</span> <span class="c1">// Invalid token return</span>
                    <span class="c1">// Developer shoud put token refreshing logic</span>
                    <span class="c1">// using `credentials/ping` endpoint</span>
                <span class="p">}</span>

                   <span class="c1">// Handle other errors</span>
           <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">func</span> <span class="nf">onError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// handle error</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onStartRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: show a loading indicator</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onFinishRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: alert user with some sound</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onProductResult</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryProductsResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">,</span> <span class="nv">productsPage</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre><pre class="highlight java tab-java"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ScanManagerInterface</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="c1">// set scan view</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">scan_activity</span><span class="o">);</span>
        <span class="n">rezolveScanView</span> <span class="o">=</span> <span class="o">(</span><span class="n">RezolveScanView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">scan_view</span><span class="o">);</span>

        <span class="c1">//get scan manager</span>
        <span class="kt">boolean</span> <span class="n">barcodeenabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">videoenabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">scanManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getScanManager</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">barcodeenabled</span><span class="o">,</span> <span class="n">videoenabled</span> <span class="o">);</span>                                     

        <span class="c1">//start video scan to acquire image</span>
        <span class="n">scanManager</span><span class="o">.</span><span class="na">startVideoScan</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">rezolveScanView</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="c1">// capture product result</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductResult</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// get product info</span>
        <span class="n">String</span> <span class="n">productId</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">subtitle</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">();</span>

        <span class="c1">// ...etc</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
<p>First, initialize <code>scanManager</code>, and enable the scan screen using <code>session.startVideoScan()</code>, and capture a watermarked image. The scanManager recognizes the encoded product data, and extracts <code>merchantId</code>, <code>catalogId</code>, and <code>productId</code> from the image, automatically calling <code>getProduct</code>. The scanManager returns a <code>product</code> object.</p>
<h4 id='2-get-shipping-and-payment-options-for-the-product'>2. Get shipping and payment options for the product</h4><pre class="highlight swift tab-swift"><code>    <span class="c1">// Fetches PaymentOption for Product</span>
    <span class="n">rezolveSession</span><span class="o">.</span><span class="nf">getProductOptions</span><span class="p">(</span>
        <span class="nv">checkoutProduct</span><span class="p">:</span> <span class="n">checkoutProduct</span><span class="p">,</span>
        <span class="nv">merchantId</span><span class="p">:</span> <span class="n">merchantId</span><span class="p">,</span>
        <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">paymentOption</span><span class="p">:</span> <span class="kt">PaymentOption</span><span class="p">)</span> <span class="k">in</span>

        <span class="k">let</span> <span class="nv">paymentMethods</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedPaymentMethods</span>
        <span class="k">let</span> <span class="nv">shippings</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedDeliveryMethods</span>

    <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">httpResponse</span> <span class="k">in</span>
        <span class="c1">// Error handling</span>
    <span class="p">})</span>

    <span class="c1">/// for this example we assume the user chooses the first option. In reality, display all options to the user, and let them choose.</span>
    <span class="k">let</span> <span class="nv">supportedPaymentMethod</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedPaymentMethods</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">shippingMethod</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedDeliveryMethods</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentOptionsMgr</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">PaymentOptionInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">PaymentOptionManager</span> <span class="n">pom</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getPaymentOptionManager</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>
        <span class="n">CheckoutProduct</span> <span class="n">checkoutProduct</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckoutProduct</span><span class="o">();</span>

        <span class="c1">// get PaymentOptions for a product</span>
        <span class="n">pom</span><span class="o">.</span><span class="na">getProductOptions</span><span class="o">(</span><span class="n">checkoutProduct</span><span class="o">,</span> <span class="n">merchantId</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>

    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductOptionsSuccess</span><span class="o">(</span><span class="n">PaymentOption</span> <span class="n">paymentOption</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CheckoutProduct</span><span class="o">&gt;</span> <span class="n">checkoutProducts</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getCheckoutProducts</span><span class="o">();</span>
        <span class="n">JSONObject</span> <span class="n">paymentOptionOptions</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getOptions</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Shipping</span><span class="o">&gt;</span> <span class="n">supportedDeliveryMethods</span> <span class="o">=</span>  <span class="n">paymentOption</span><span class="o">.</span><span class="na">getSupportedDeliveryMethods</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">SupportedPaymentMethod</span><span class="o">&gt;</span> <span class="n">supportedPaymentMethods</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getSupportedPaymentMethods</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">CheckoutProduct</span> <span class="n">checkoutProduct</span> <span class="o">:</span> <span class="n">checkoutProducts</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// breakdown checkoutProduct object</span>
            <span class="kt">float</span> <span class="n">qty</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getQty</span><span class="o">();</span>
            <span class="n">Placement</span> <span class="n">productPlacement</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getProductPlacement</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">cpId</span>  <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">ConfigurableOption</span><span class="o">&gt;</span> <span class="n">configurableOptions</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getConfigurableOptions</span><span class="o">();</span>

            <span class="n">String</span> <span class="n">placementId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getPlacementId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">adId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getAdId</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">ConfigurableOption</span> <span class="n">configurableOption</span> <span class="o">:</span> <span class="n">configurableOptions</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">configurableOption</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">configurableOption</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Shipping</span> <span class="n">shipping</span> <span class="o">:</span> <span class="n">supportedDeliveryMethods</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ShippingDetails</span> <span class="n">shippingDetails</span> <span class="o">=</span> <span class="n">shipping</span><span class="o">.</span><span class="na">getShippingDetails</span><span class="o">();</span>
            <span class="n">ShippingMethod</span> <span class="n">shippingMethod</span> <span class="o">=</span> <span class="n">shipping</span><span class="o">.</span><span class="na">getShippingMethod</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">SupportedPaymentMethod</span> <span class="n">supportedPaymentMethod</span> <span class="o">:</span> <span class="n">supportedPaymentMethods</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">PaymentMethodData</span> <span class="n">paymentMethodData</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getPaymentMethodData</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">spmType</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
            <span class="n">JSONObject</span> <span class="n">originalDataJson</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getOriginalDataJson</span><span class="o">();</span>

            <span class="n">JSONObject</span> <span class="n">requirements</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getRequirements</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedDelivery</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedDelivery</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedNetworks</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedNetworks</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedTypes</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedTypes</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Call <code>PaymentOptionManager</code> to get shipping and payment options for the current merchant. This tutorial assumes the consumer chose a form of credit card payment, and chose home delivery. </p>

<p>Note: You must repeat this call if the user chooses a different product variant (size, color, etc), changes product quantity, changes shipping choice, or changes payment option.</p>

<p>For more information on what is returned by <code>getProductOptions</code>, see the <a href="#background-listening">Background Listening</a> tutorial.</p>
<h4 id='3-show-payment-card-choices'>3. Show payment card choices</h4><pre class="highlight swift tab-swift"><code>
  <span class="n">mySession</span><span class="p">?</span><span class="o">.</span><span class="n">walletManager</span><span class="o">.</span><span class="nf">getAll</span><span class="p">()</span> <span class="p">{</span> <span class="p">(</span><span class="nv">listOfCards</span><span class="p">:</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">PaymentCard</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
      <span class="c1">// handle list of cards here</span>
  <span class="p">}</span>

</code></pre><pre class="highlight java tab-java"><code>
<span class="n">rezolveSession</span><span class="o">.</span><span class="na">getWalletManager</span><span class="o">().</span><span class="na">getAll</span><span class="o">(</span><span class="k">new</span> <span class="n">WalletCallback</span><span class="o">()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onWalletGetAllSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentCard</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle getAll response here</span>
    <span class="o">}</span>

<span class="o">});</span>

</code></pre>
<p>Use <code>walletManager.getAll</code> to list the available card choices. If the consumer wishes to buy, they will select a payment card to use, and provide confirmation of ordering intent.</p>

<p>We recommend using a &quot;slide to buy&quot; button to confirm purchase intent, while preserving the maximum ease of use.</p>
<h4 id='4-create-a-checkout-bundle-checkout-the-product-to-get-totals-and-create-an-order'>4. Create a checkout bundle, checkout the product to get totals, and create an order</h4><pre class="highlight swift tab-swift"><code><span class="k">let</span> <span class="nv">productBundleV2</span> <span class="o">=</span> <span class="nf">createProductCheckoutBundleV2</span><span class="p">(</span>
    <span class="nv">checkoutProduct</span><span class="p">:</span> <span class="n">checkoutProduct</span><span class="p">,</span>
    <span class="k">let</span> <span class="nv">delivery</span> <span class="o">=</span> <span class="kt">DeliveryMethod</span><span class="p">(</span><span class="nv">addressId</span><span class="p">:</span> <span class="n">addressObject</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="c1">// address id is blank because this is only needed for Click and Collect</span>
    <span class="nv">merchantId</span><span class="p">:</span> <span class="n">merchantId</span><span class="p">,</span>
    <span class="nv">optionId</span><span class="p">:</span> <span class="n">optionId</span><span class="p">,</span>
    <span class="nv">paymentMethod</span><span class="p">:</span> <span class="n">paymentMethod</span><span class="p">,</span>
    <span class="nv">phoneId</span><span class="p">:</span> <span class="n">phoneId</span>
<span class="p">)</span>

<span class="n">rezolveSession</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">checkout</span><span class="p">(</span>
    <span class="nv">bundle</span><span class="p">:</span> <span class="n">productBundleV2</span><span class="p">,</span> 
    <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">order</span> <span class="k">in</span> 
        <span class="c1">// Order handling</span>
    <span class="p">},</span>
    <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> 
        <span class="c1">// Error handling</span>
<span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductResult</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// get product info</span>
    <span class="n">String</span> <span class="n">product_id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">subtitle</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">();</span>
    <span class="c1">// ... etc</span>


    <span class="c1">// create a CheckoutProduct object with the product id , and set the quantity</span>
    <span class="n">CheckoutProduct</span> <span class="n">checkoutProduct</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckoutProduct</span><span class="o">();</span>
    <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">product_id</span><span class="o">));</span>
    <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">setQty</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

   <span class="c1">// use info from productPaymentOption to populate Shipping and PaymentMethod choices...</span>
    <span class="n">String</span> <span class="n">productPaymentOptionId</span> <span class="o">=</span> <span class="n">productPaymentOption</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">SupportedPaymentMethod</span><span class="o">&gt;</span> <span class="n">supportedPaymentMethods</span> <span class="o">=</span> <span class="n">productPaymentOption</span><span class="o">.</span><span class="na">getSupportedPaymentMethods</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Shipping</span><span class="o">&gt;</span> <span class="n">deliveryMethods</span> <span class="o">=</span> <span class="n">productPaymentOption</span><span class="o">.</span><span class="na">getSupportedDeliveryMethods</span><span class="o">();</span>
    <span class="n">SupportedPaymentMethod</span> <span class="n">supportedPaymentMethod</span> <span class="o">=</span> <span class="n">supportedPaymentMethods</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>  <span class="c1">// in reality customer chooses an option here</span>
    <span class="n">Shipping</span> <span class="n">deliveryMethod</span> <span class="o">=</span> <span class="n">deliveryMethods</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// in reality customer chooses an option here</span>
    <span class="n">String</span> <span class="n">phonebookId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// use real consumer phonebook id</span>

    <span class="c1">// create the delivery unit</span>
    <span class="n">DeliveryUnit</span> <span class="n">deliveryUnit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DeliveryUnit</span><span class="o">(</span><span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span> 

    <span class="c1">// create a product checkout bundle           </span>
    <span class="n">CheckoutBundleV2</span><span class="o">.</span><span class="na">createProductCheckoutBundleV2</span><span class="o">(</span><span class="n">merchantId</span><span class="o">,</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">checkoutProduct</span><span class="o">,</span> <span class="n">phoneId</span><span class="o">,</span> <span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">deliveryUnit</span><span class="o">);</span>

    <span class="c1">// call the CheckoutProductOption method to get an order object and totals</span>
    <span class="n">checkout</span><span class="o">.</span><span class="na">checkoutProductOption</span><span class="o">(</span><span class="n">productCheckoutBundleV2</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutV2Callback</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCheckoutProductSuccess</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// get pricing breakdown and final price</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">PriceBreakdown</span><span class="o">&gt;</span> <span class="n">pricingBreakdown</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getBreakdowns</span><span class="o">();</span>
            <span class="kt">float</span> <span class="n">finalPrice</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getFinalPrice</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>

            <span class="c1">// create a paymentRequest object, and then use this with the checkoutProduct object to purchase the item.</span>
            <span class="n">PaymentCard</span> <span class="n">paymentCard</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PaymentCard</span><span class="o">();</span> <span class="c1">// use consumer's chosen payment card</span>
            <span class="n">String</span> <span class="n">cvv</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// use actual cvv</span>
            <span class="n">PaymentRequest</span> <span class="n">paymentRequest</span> <span class="o">=</span> <span class="n">checkout</span><span class="o">.</span><span class="na">createPaymentRequest</span><span class="o">(</span><span class="n">paymentCard</span><span class="o">,</span><span class="n">cvv</span><span class="o">);</span>

            <span class="c1">// buy a single product</span>
            <span class="n">checkout</span><span class="o">.</span><span class="na">buyProduct</span><span class="o">(</span><span class="n">paymentRequest</span><span class="o">,</span> <span class="n">productCheckoutBundleV2</span><span class="o">,</span> <span class="n">orderId</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutV2Callback</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductOptionBuySuccess</span><span class="o">(</span><span class="n">OrderSummary</span> <span class="n">orderSummary</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kd">super</span><span class="o">.</span><span class="na">onProductOptionBuySuccess</span><span class="o">(</span><span class="n">orderSummary</span><span class="o">);</span>
                    <span class="c1">//display order summary</span>
                    <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
                    <span class="n">JSONObject</span> <span class="n">orderData</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">});</span>

        <span class="o">}</span>
    <span class="o">});</span>
<span class="o">}</span>
</code></pre>
<p>Once you have product information, create a CheckoutProduct object. Then call the SDK <code>CheckoutManagerV2.checkoutProduct</code> method to create an order and get totals.  The response order object includes an order id, order total, and price breakdowns.</p>
<h4 id='5-submit-payment-for-order'>5. Submit payment for order</h4><pre class="highlight swift tab-swift"><code>    <span class="k">let</span> <span class="nv">paymentCard</span> <span class="o">=</span> <span class="c1">// RezolveSDK.PaymentCard</span>

    <span class="k">let</span> <span class="nv">cardCVV</span> <span class="o">=</span> <span class="s">"000"</span> <span class="c1">// Card CVV</span>

    <span class="k">let</span> <span class="nv">paymentRequest</span> <span class="o">=</span> <span class="kt">PaymentRequest</span><span class="p">(</span>
        <span class="nv">paymentCard</span><span class="p">:</span> <span class="n">paymentCard</span><span class="p">,</span> 
        <span class="nv">cvv</span><span class="p">:</span> <span class="n">cardCVV</span>
    <span class="p">)</span>

    <span class="n">rezolveSession</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">buy</span><span class="p">(</span>
        <span class="nv">bundle</span><span class="p">:</span> <span class="n">productBundleV2</span><span class="p">,</span>
        <span class="nv">paymentRequest</span><span class="p">:</span> <span class="n">paymentRequest</span><span class="p">,</span>
        <span class="nv">checkoutId</span><span class="p">:</span> <span class="n">checkoutId</span><span class="p">,</span>
        <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">checkoutOrder</span> <span class="k">in</span>
            <span class="c1">// CheckoutOrder handling</span>
        <span class="p">},</span>
        <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> 
            <span class="c1">// Error handling</span>
    <span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// create a paymentRequest object, and then use this with the checkoutBundle object </span>

<span class="c1">// create paymentRequest object</span>
<span class="n">PaymentCard</span> <span class="n">paymentCard</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PaymentCard</span><span class="o">();</span> <span class="c1">// use consumer's chosen payment card from step 3</span>
<span class="n">String</span> <span class="n">cvv</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// use actual cvv</span>
<span class="n">PaymentRequest</span> <span class="n">paymentRequest</span> <span class="o">=</span> <span class="n">checkout</span><span class="o">.</span><span class="na">createPaymentRequest</span><span class="o">(</span><span class="n">paymentCard</span><span class="o">,</span><span class="n">cvv</span><span class="o">);</span>


<span class="c1">// buy a single product</span>
<span class="n">checkoutManagerV2</span><span class="o">.</span><span class="na">buyProduct</span><span class="o">(</span><span class="n">paymentRequest</span><span class="o">,</span> <span class="n">productCheckoutBundleV2</span><span class="o">,</span> <span class="n">orderId</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductOptionBuySuccess</span><span class="o">(</span><span class="n">OrderSummary</span> <span class="n">orderSummary</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// skip this call, ContactInformation entity is not public</span>
    <span class="c1">// Merchant.ContactInformation contactInformation = orderSummary.getContactInformation();</span>
    <span class="n">JSONObject</span> <span class="n">orderData</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">partnerId</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getPartnerId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">partnerName</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getPartnerName</span><span class="o">();</span>
<span class="o">}</span>

</code></pre>
<p>When the user confirms intent, pass the card choice and the entered CVV value to the <code>createPaymentRequest</code> method. This creates the encrypted <code>paymentRequest</code> object needed for checkout.</p>

<p>In this tutorial, we assume the user chose credit card payment. Note that <code>paymentRequest</code> is actually optional here, and can be null. To determine if it&#39;s needed, please check selected <code>SupportedPaymentMethod</code>&#39;s type.</p>

<p>Pass a <code>paymentRequest</code> object, <code>checkoutBundleV2</code> object, the <code>orderId</code>, and an interface or callback to the <code>buyProduct</code> method. The success response will an <code>OrderSummary</code> object. Note that this does not mean the order was confirmed, only that the request was successfully received.</p>

<p>When the method returns successfully, it will automatically initiate the signOrderUpdate method.</p>
<h4 id='6-wait-for-signorderupdate-to-return-a-final-order-status'>6. Wait for signOrderUpdate to return a final order status.</h4><pre class="highlight swift tab-swift"><code><span class="n">session</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">buyCart</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">cart</span><span class="p">:</span> <span class="n">cartDetails</span><span class="p">,</span> <span class="nv">address</span><span class="p">:</span> <span class="n">remoteAddress</span><span class="p">,</span> <span class="nv">paymentRequest</span><span class="p">:</span> <span class="n">paymentRequest</span><span class="p">,</span> <span class="nv">location</span><span class="p">:</span> <span class="kt">DEFAULT_LOCATIONS</span><span class="p">,</span> <span class="nv">phone</span><span class="p">:</span> <span class="n">phone</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">order</span><span class="p">:</span> <span class="kt">CheckoutOrder</span><span class="p">)</span> <span class="k">in</span>

<span class="n">session</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">signOrderUpdate</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">order</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">status</span><span class="p">,</span> <span class="n">transaction</span> <span class="k">in</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">completed</span> <span class="p">{</span>


    <span class="p">}</span>
<span class="p">})</span>

<span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onOrderUpdateReceived</span><span class="o">(</span><span class="n">Transaction</span><span class="o">.</span><span class="na">Status</span> <span class="n">status</span><span class="o">,</span> <span class="n">Transaction</span> <span class="n">transaction</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// get properties of status object</span>
    <span class="n">String</span> <span class="n">statusLabel</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>   <span class="c1">// will return one of: completed, canceled, or processing</span>

    <span class="c1">// get properties of transaction object</span>
    <span class="n">String</span> <span class="n">transStatus</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">transOrderId</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">transLastUpdated</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getLastUpdated</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
<p>SignOrderUpdate starts a socket listener with the order id, and waits for the server to return an order status. The server will return one of three status: 
- completed
- canceled
- processing</p>

<p>If either <code>completed</code> or <code>canceled</code> is returned, the listener stops and the socket closes. If <code>processing</code> is returned, the listener will remain active until the order status is updated to either <code>completed</code> or <code>canceled</code>.</p>

          <h2 id='product-scan-cart-flow'>Product Scan, Cart flow</h2>
<p><img src="images/wsd-jwt-cart-buy-flow.png" style="margin:6px 0;"><br/>[ <a href="images/wsd-jwt-cart-buy-flow.png" target="_blank">View full size</a> ]</p>

<p>The premise of Shoppable Ads is to capture an image scan (usually of an advertisement) using the Scan Manager, resolve it into a product URL, fetch the product info, and enable purchase via saved account information.</p>

<p>In the Cart Buy flow, one or more products are added to a cart. Each merchant will have a separate cart, and multiple carts can contain products at a time. For this example we are assuming only one cart is active, but you can check for multiple carts using <code>CheckoutManagerV2.getCarts</code>.</p>
<h4 id='1-capture-image-and-get-product'>1. Capture image and get product</h4><pre class="highlight swift tab-swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">ProductDelegate</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

            <span class="c1">// Initialize RezolveSDK</span>
            <span class="k">let</span> <span class="nv">rezolveSdk</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span>
                <span class="nv">apiKey</span><span class="p">:</span> <span class="kt">REZOLVE_API_KEY</span><span class="p">,</span> 
                <span class="nv">env</span><span class="p">:</span> <span class="kt">REZOLVE_SDK_ENV</span><span class="p">,</span> 
                <span class="nv">config</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> 
                <span class="nv">dataClient</span><span class="p">:</span> <span class="n">dataClient</span>
            <span class="p">)</span>

            <span class="c1">// Creates Session</span>
            <span class="n">rezolveSdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
                <span class="nv">accessToken</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> 
                <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> 
                <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
                <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">session</span> <span class="k">in</span>

                    <span class="k">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="n">productResultDelegate</span> <span class="o">=</span> <span class="k">self</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="nf">startVideoScan</span><span class="p">(</span><span class="nv">scanCameraView</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="k">as!</span> <span class="kt">ScanCameraView</span><span class="p">)</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">401</span> <span class="p">{</span> <span class="c1">// Invalid token return</span>
                    <span class="c1">// Developer shoud put token refreshing logic</span>
                    <span class="c1">// using `credentials/ping` endpoint</span>
                <span class="p">}</span>

                   <span class="c1">// Handle other errors</span>
           <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">func</span> <span class="nf">onError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// handle error</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onStartRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: show a loading indicator</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onFinishRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: alert user with some sound</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onProductResult</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryProductsResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">,</span> <span class="nv">productsPage</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre><pre class="highlight java tab-java"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ScanManagerInterface</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="c1">// set scan view</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">scan_activity</span><span class="o">);</span>
        <span class="n">rezolveScanView</span> <span class="o">=</span> <span class="o">(</span><span class="n">RezolveScanView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">scan_view</span><span class="o">);</span>

        <span class="c1">//get scan manager</span>
        <span class="n">scanManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getScanManager</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

          <span class="c1">//start video scan to acquire image</span>
          <span class="n">scanManager</span><span class="o">.</span><span class="na">startVideoScan</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">rezolveScanView</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="c1">// capture product result</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductResult</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// get product info</span>
        <span class="n">String</span> <span class="n">productId</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">subtitle</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">();</span>

        <span class="c1">// ...etc</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
<p>First, initialize <code>scanManager</code>, and enable the scan screen using <code>session.startVideo()</code>, and capture a watermarked image. The scanManager recognizes the encoded product data, and extracts <code>merchantId</code>, <code>catalogId</code>, and <code>productId</code> from the image, automatically calling <code>getProduct</code>. The scanManager returns a <code>product</code> object.</p>
<h4 id='2-add-product-to-the-cart'>2. Add Product to the Cart</h4><pre class="highlight swift tab-swift"><code><span class="k">let</span> <span class="nv">checkoutProduct</span> <span class="o">=</span> <span class="nf">createCheckoutProductWithVariant</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="n">product</span><span class="p">)</span>

<span class="n">session</span><span class="o">.</span><span class="n">cartManager</span><span class="o">.</span><span class="nf">createCartWithProduct</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">product</span><span class="p">:</span> <span class="n">checkoutProduct</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">cartDetails</span> <span class="k">in</span>

<span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// add product to cart</span>
<span class="n">checkout</span><span class="o">.</span><span class="na">addProductToCart</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">checkoutProduct</span><span class="o">,</span> <span class="n">merchantId</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAddProductsToCartSuccess</span><span class="o">(</span><span class="n">CartDetails</span> <span class="n">cartDetails</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onAddProductsToCartSuccess</span><span class="o">(</span><span class="n">cartDetails</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">cartId</span> <span class="o">=</span> <span class="n">cartDetails</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">//use actual merchant id</span>
        <span class="n">String</span> <span class="n">addressId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>  <span class="c1">//use actual address id</span>

        <span class="c1">// immediately call CheckoutCart to get an Order with totals</span>
        <span class="n">checkout</span><span class="o">.</span><span class="na">addProductToCart</span><span class="o">(</span> <span class="n">checkoutProduct</span><span class="o">,</span> <span class="n">merchantId</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAddProductsToCartSuccess</span><span class="o">(</span><span class="n">CartDetails</span> <span class="n">cartDetails</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">super</span><span class="o">.</span><span class="na">onAddProductsToCartSuccess</span><span class="o">(</span><span class="n">cartDetails</span><span class="o">);</span>

                <span class="n">String</span> <span class="n">cartId</span> <span class="o">=</span> <span class="n">cartDetails</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">//use actual merchant id</span>
                <span class="n">String</span> <span class="n">addressId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>  <span class="c1">//use actual address id</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<p>Call <code>CheckoutManagerV2.addProductToCart</code> to add the product to cart.</p>
<h4 id='3-get-shipping-and-payment-options-for-the-cart'>3. Get shipping and payment options for the cart</h4><pre class="highlight swift tab-swift"><code>    <span class="c1">// Fetch PaymentOption for cart</span>
    <span class="n">rezolveSession</span><span class="o">.</span><span class="n">paymentOptionManager</span><span class="o">.</span><span class="nf">getCartOptions</span><span class="p">(</span>
        <span class="nv">merchantId</span><span class="p">:</span> <span class="n">merchantId</span><span class="p">,</span>
        <span class="nv">cartId</span><span class="p">:</span> <span class="n">cartId</span><span class="p">,</span>
        <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">paymentOptionList</span><span class="p">:</span> <span class="p">[</span><span class="kt">PaymentOption</span><span class="p">])</span> <span class="k">in</span>

            <span class="c1">// Handle [PaymentOption]</span>

    <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">httpResponse</span> <span class="k">in</span>
        <span class="c1">// Error handling code</span>
    <span class="p">})</span>

    <span class="c1">/// for this example we assume the user chooses the first option. In reality, display all options to the user, and let them choose.</span>
    <span class="k">let</span> <span class="nv">supportedPaymentMethod</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedPaymentMethods</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>
    <span class="k">let</span> <span class="nv">shippingMethod</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedDeliveryMethods</span><span class="o">.</span><span class="n">first</span><span class="o">!</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentOptionsMgr</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">PaymentOptionInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">PaymentOptionManager</span> <span class="n">pom</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getPaymentOptionManager</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">cartId</span> <span class="o">=</span> <span class="s">"12345"</span><span class="o">;</span>

        <span class="c1">// get PaymentOptions for cart</span>
        <span class="n">pom</span><span class="o">.</span><span class="na">getCartOptions</span><span class="o">(</span> <span class="n">merchantId</span><span class="o">,</span> <span class="n">cartId</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCartOptionsSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentOption</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">PaymentOption</span> <span class="n">paymentOption</span> <span class="o">:</span> <span class="n">list</span> <span class="o">){</span>
            <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">SupportedPaymentMethod</span><span class="o">&gt;</span> <span class="n">supportedPaymentMethods</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getSupportedPaymentMethods</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Shipping</span><span class="o">&gt;</span> <span class="n">supportedDeliveryMethods</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getSupportedDeliveryMethods</span><span class="o">();</span>
            <span class="n">JSONObject</span> <span class="n">options</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getOptions</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">CheckoutProduct</span><span class="o">&gt;</span> <span class="n">checkoutProducts</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="na">getCheckoutProducts</span><span class="o">();</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">SupportedPaymentMethod</span> <span class="n">supportedPaymentMethod</span> <span class="o">:</span> <span class="n">supportedPaymentMethods</span> <span class="o">)</span> <span class="o">{</span>
                <span class="n">PaymentMethodData</span> <span class="n">paymentMethodData</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getPaymentMethodData</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">spmType</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
                <span class="n">JSONObject</span> <span class="n">originalDataJson</span> <span class="o">=</span> <span class="n">supportedPaymentMethod</span><span class="o">.</span><span class="na">getOriginalDataJson</span><span class="o">();</span>

                <span class="n">JSONObject</span> <span class="n">requirements</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getRequirements</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedDelivery</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedDelivery</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedNetworks</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedNetworks</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supportedTypes</span> <span class="o">=</span> <span class="n">paymentMethodData</span><span class="o">.</span><span class="na">getSupportedTypes</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">Shipping</span> <span class="n">shipping</span> <span class="o">:</span> <span class="n">supportedDeliveryMethods</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ShippingDetails</span> <span class="n">shippingDetails</span> <span class="o">=</span> <span class="n">shipping</span><span class="o">.</span><span class="na">getShippingDetails</span><span class="o">();</span>
                <span class="n">ShippingMethod</span> <span class="n">shippingMethod</span> <span class="o">=</span> <span class="n">shipping</span><span class="o">.</span><span class="na">getShippingMethod</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">CheckoutProduct</span> <span class="n">checkoutProduct</span> <span class="o">:</span> <span class="n">checkoutProducts</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// breakdown checkoutProduct object</span>
                <span class="kt">float</span> <span class="n">qty</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getQty</span><span class="o">();</span>
                <span class="n">Placement</span> <span class="n">productPlacement</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getProductPlacement</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">cpId</span>  <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">ConfigurableOption</span><span class="o">&gt;</span> <span class="n">configurableOptions</span> <span class="o">=</span> <span class="n">checkoutProduct</span><span class="o">.</span><span class="na">getConfigurableOptions</span><span class="o">();</span>

                <span class="n">String</span> <span class="n">placementId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getPlacementId</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">adId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getAdId</span><span class="o">();</span>

                <span class="k">for</span> <span class="o">(</span><span class="n">ConfigurableOption</span> <span class="n">configurableOption</span> <span class="o">:</span> <span class="n">configurableOptions</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">configurableOption</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                    <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">configurableOption</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">HttpResponse</span> <span class="n">httpResponse</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle error</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="c1">// Assuming the user picks traditional shipping. </span>
<span class="c1">// Click and Collect options are discussed in a separate tutorial.</span>
<span class="c1">// Create DeliveryUnit as follows:  </span>


</code></pre>
<p>Call <code>PaymentOptionManager</code> to get shipping and payment options for the current merchant. This tutorial assumes the consumer chose a form of credit card payment, and chose home delivery. </p>

<p>Note: You must repeat this call if the user chooses a different product variant (size, color, etc), changes product quantity, changes shipping choice, or changes payment option.</p>

<p>For more information on what is returned by <code>getCartOptions</code>, see the <a href="#background-listening">Background Listening</a> tutorial.</p>
<h4 id='4-show-payment-card-choices'>4. Show payment card choices</h4><pre class="highlight swift tab-swift"><code>  <span class="n">mySession</span><span class="p">?</span><span class="o">.</span><span class="n">walletManager</span><span class="o">.</span><span class="nf">getAll</span><span class="p">()</span> <span class="p">{</span> <span class="p">(</span><span class="nv">listOfCards</span><span class="p">:</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">PaymentCard</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
      <span class="c1">// handle list of cards here</span>
  <span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">rezolveSession</span><span class="o">.</span><span class="na">getWalletManager</span><span class="o">().</span><span class="na">getAll</span><span class="o">(</span><span class="k">new</span> <span class="n">WalletCallback</span><span class="o">()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onWalletGetAllSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">PaymentCard</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle getAll response here</span>
    <span class="o">}</span>
<span class="o">});</span>

</code></pre>
<p>Use <code>walletManager.getAll</code> to list the available card choices. If the consumer wishes to buy, they will select a payment card to use, and provide confirmation of ordering intent.</p>

<p>We recommend using a &quot;slide to buy&quot; button to confirm purchase intent, while preserving the maximum ease of use.</p>
<h4 id='5-create-a-checkout-bundle-checkout-the-cart-to-get-totals-and-create-an-order'>5. Create a checkout bundle, checkout the cart to get totals, and create an order</h4><pre class="highlight swift tab-swift"><code>    <span class="k">let</span> <span class="nv">cartCheckoutBundleV2</span> <span class="o">=</span> <span class="nf">createCartCheckoutBundleV2</span><span class="p">(</span>
        <span class="nv">cartId</span><span class="p">:</span> <span class="n">cartId</span><span class="p">,</span>
        <span class="k">let</span> <span class="nv">delivery</span> <span class="o">=</span> <span class="kt">DeliveryMethod</span><span class="p">(</span><span class="nv">addressId</span><span class="p">:</span> <span class="n">addressObject</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="c1">// address id is blank because this is only needed for Click and Collect</span>
        <span class="nv">merchantId</span><span class="p">:</span> <span class="n">merchantId</span><span class="p">,</span>
        <span class="nv">optionId</span><span class="p">:</span> <span class="n">optionId</span><span class="p">,</span>
        <span class="nv">paymentMethod</span><span class="p">:</span> <span class="n">paymentMethod</span><span class="p">,</span>
        <span class="nv">phoneId</span><span class="p">:</span> <span class="n">phoneId</span>
    <span class="p">)</span>

    <span class="n">rezolveSession</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">checkout</span><span class="p">(</span>
        <span class="nv">bundle</span><span class="p">:</span> <span class="n">cartCheckoutBundleV2</span><span class="p">,</span> 
        <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="kt">Order</span> <span class="k">in</span> 
            <span class="c1">// Order handling</span>
        <span class="p">},</span>
        <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> 
            <span class="c1">// Error handling</span>
    <span class="p">})</span>

</code></pre><pre class="highlight java tab-java"><code><span class="c1">// create a Cart Checkout Bundle</span>
<span class="n">String</span> <span class="n">phonebookId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// use real consumer phonebook id</span>
<span class="n">String</span> <span class="n">optionId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// get this from productPaymentOption.getId();</span>
<span class="n">String</span> <span class="n">cartId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>
<span class="n">SupportedPaymentMethod</span> <span class="n">supportedPaymentMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SupportedPaymentMethod</span><span class="o">();</span> <span class="c1">//get this from productPaymentOption.getSupportedPaymentMethods()</span>

<span class="c1">// create the delivery unit</span>
<span class="n">DeliveryUnit</span> <span class="n">deliveryUnit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DeliveryUnit</span><span class="o">(</span><span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span> 
<span class="n">CheckoutBundleV2</span> <span class="n">checkoutBundleV2</span> <span class="o">=</span> <span class="n">CheckoutBundleV2</span><span class="o">.</span><span class="na">createCartCheckoutBundleV2</span><span class="o">(</span> <span class="n">merchantId</span><span class="o">,</span> <span class="n">optionId</span><span class="o">,</span> <span class="n">cartId</span><span class="o">,</span> <span class="n">phonebookId</span><span class="o">,</span> <span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">deliveryUnit</span><span class="o">);</span>

<span class="c1">// call CheckoutCartOption method to get an order object and totals</span>
<span class="n">checkout</span><span class="o">.</span><span class="na">checkoutCartOption</span><span class="o">(</span><span class="n">cartCheckoutBundleV2</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutV2Callback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCartOptionCheckoutSuccess</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCartOptionCheckoutSuccess</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="c1">// get order id</span>
        <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
        <span class="c1">// get price breakdowns</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PriceBreakdown</span><span class="o">&gt;</span> <span class="n">priceBreakdowns</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getBreakdowns</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<p>Create a cart checkout bundle.  Then call the SDK <code>CheckoutManagerV2.checkoutCart</code> method (Android) or <code>CheckoutManagerV2.checkout</code> (IOS)  method to create an order and get totals.  The response order object includes an order id, order total, and price breakdowns.</p>
<h4 id='6-submit-payment-for-order'>6. Submit payment for order</h4><pre class="highlight swift tab-swift"><code>    <span class="k">let</span> <span class="nv">paymentCard</span> <span class="o">=</span> <span class="c1">// RezolveSDK.PaymentCard</span>

    <span class="k">let</span> <span class="nv">cardCVV</span> <span class="o">=</span> <span class="s">"000"</span> <span class="c1">// Card CVV</span>

    <span class="k">let</span> <span class="nv">paymentRequest</span> <span class="o">=</span> <span class="kt">PaymentRequest</span><span class="p">(</span>
        <span class="nv">paymentCard</span><span class="p">:</span> <span class="n">paymentCard</span><span class="p">,</span> 
        <span class="nv">cvv</span><span class="p">:</span> <span class="n">cardCVV</span>
    <span class="p">)</span>

    <span class="c1">// buy the cart</span>
    <span class="n">rezolveSession</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">buy</span><span class="p">(</span>
        <span class="nv">bundle</span><span class="p">:</span> <span class="n">cartCheckoutBundleV2</span><span class="p">,</span>
        <span class="nv">paymentRequest</span><span class="p">:</span> <span class="n">paymentRequest</span><span class="p">,</span>
        <span class="nv">checkoutId</span><span class="p">:</span> <span class="n">checkoutId</span><span class="p">,</span>
        <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">checkoutOrder</span> <span class="k">in</span>
            <span class="c1">// Handle checkoutOrder</span>
        <span class="p">},</span>
        <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> 
            <span class="c1">// Handle error</span>
    <span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code>    <span class="c1">// create a paymentRequest object, and then use this with the checkoutProduct object to purchase the cart.</span>
    <span class="n">PaymentCard</span> <span class="n">paymentCard</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PaymentCard</span><span class="o">();</span> <span class="c1">// use consumer's chosen payment card</span>
    <span class="n">String</span> <span class="n">cvv</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span> <span class="c1">// use actual cvv</span>
    <span class="n">PaymentRequest</span> <span class="n">paymentRequest</span> <span class="o">=</span> <span class="n">checkout</span><span class="o">.</span><span class="na">createPaymentRequest</span><span class="o">(</span><span class="n">paymentCard</span><span class="o">,</span><span class="n">cvv</span><span class="o">);</span>

    <span class="c1">// buy the cart</span>
    <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>  <span class="c1">// get from order.getOrderId();</span>
    <span class="n">checkout</span><span class="o">.</span><span class="na">buyCart</span><span class="o">(</span><span class="n">paymentRequest</span><span class="o">,</span> <span class="n">cartCheckoutBundleV2</span><span class="o">,</span> <span class="n">orderId</span><span class="o">,</span> <span class="k">new</span> <span class="n">CheckoutV2Callback</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCartOptionBuySuccess</span><span class="o">(</span><span class="n">OrderSummary</span> <span class="n">orderSummary</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">onCartOptionBuySuccess</span><span class="o">(</span><span class="n">orderSummary</span><span class="o">);</span>
            <span class="c1">//display order summary</span>
            <span class="n">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
            <span class="n">JSONObject</span> <span class="n">orderData</span> <span class="o">=</span> <span class="n">orderSummary</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>
</code></pre>
<p>When the user confirms intent, pass the card choice and the entered CVV value to the <code>createPaymentRequest</code> method. This creates the encrypted <code>paymentRequest</code> object needed for checkout.</p>

<p>In this tutorial, we assume the user chose credit card payment. Note that <code>paymentRequest</code> is actually optional here, and can be null. To determine if it&#39;s needed, please check selected <code>SupportedPaymentMethod</code>&#39;s type.</p>

<p>Pass the <code>paymentRequest</code> object, the<code>checkoutBundleV2</code> object, the <code>orderId</code>,  and an interface or callback to the <code>buyCart</code> method. The success response will be the <code>order id</code> as a string. Note that this does not mean the order was confirmed, only that the request was successfully received.</p>

<p>When the method returns successfully, in Android it will automatically initiate the signOrderUpdate method. In IOS, call signOrderUpdate in the callback.</p>
<h4 id='7-wait-for-signorderupdate-to-return-a-final-order-status'>7. Wait for signOrderUpdate to return a final order status.</h4><pre class="highlight swift tab-swift"><code><span class="n">session</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">buyCart</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">cart</span><span class="p">:</span> <span class="n">cartDetails</span><span class="p">,</span> <span class="nv">address</span><span class="p">:</span> <span class="n">remoteAddress</span><span class="p">,</span> <span class="nv">paymentRequest</span><span class="p">:</span> <span class="n">paymentRequest</span><span class="p">,</span> <span class="nv">location</span><span class="p">:</span> <span class="kt">DEFAULT_LOCATIONS</span><span class="p">,</span> <span class="nv">phone</span><span class="p">:</span> <span class="n">phone</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">order</span><span class="p">:</span> <span class="kt">CheckoutOrder</span><span class="p">)</span> <span class="k">in</span>

<span class="n">session</span><span class="o">.</span><span class="n">checkoutManagerV2</span><span class="o">.</span><span class="nf">signOrderUpdate</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">order</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">status</span><span class="p">,</span> <span class="n">transaction</span> <span class="k">in</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">completed</span> <span class="p">{</span>


    <span class="p">}</span>
<span class="p">})</span>

<span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onOrderUpdateReceived</span><span class="o">(</span><span class="n">Transaction</span><span class="o">.</span><span class="na">Status</span> <span class="n">status</span><span class="o">,</span> <span class="n">Transaction</span> <span class="n">transaction</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// get properties of status object</span>
    <span class="n">String</span> <span class="n">statusLabel</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>   <span class="c1">// will return one of: completed, canceled, or processing</span>

    <span class="c1">// get properties of transaction object</span>
    <span class="n">String</span> <span class="n">transStatus</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">transOrderId</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">transLastUpdated</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getLastUpdated</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
<p>SignOrderUpdate starts a socket listener with the order id, and waits for the server to return an order status. The server will return one of three status: 
- completed
- canceled
- processing</p>

<p>If either <code>completed</code> or <code>canceled</code> is returned, the listener stops and the socket closes. If <code>processing</code> is returned, the listener will remain active until the order status is updated to either <code>completed</code> or <code>canceled</code>.</p>

          <h2 id='category-scan-flow'>Category Scan flow</h2>
<p><img src="images/wsd-jwt-category-flow.png" style="margin:6px 0;"><br/>[ <a href="images/wsd-jwt-category-flow.png" target="_blank">View full size</a> ]</p>

<p>Shoppable Ads can do more than link to a single product, it can link to a category of products in your Rezolve Commerce Engine. Scanning an ad that contains a category link will bring up a list of subcategories and products in that category.</p>

<p>Once a product has been selected, purchasing follows one of the previous examples of Instant Buy Flow or Cart Buy Flow (minus the scan step).</p>
<h4 id='1-scan-a-category-shoppable-ad-get-a-getcatalog-response'>1. Scan a category shoppable ad,  get a getCatalog response</h4><pre class="highlight swift tab-swift"><code><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">ProductDelegate</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// Initialize RezolveSDK</span>
            <span class="k">let</span> <span class="nv">rezolveSdk</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span>
                <span class="nv">apiKey</span><span class="p">:</span> <span class="kt">REZOLVE_API_KEY</span><span class="p">,</span> 
                <span class="nv">env</span><span class="p">:</span> <span class="kt">REZOLVE_SDK_ENV</span><span class="p">,</span> 
                <span class="nv">config</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> 
                <span class="nv">dataClient</span><span class="p">:</span> <span class="n">dataClient</span>
            <span class="p">)</span>

            <span class="c1">// Creates Session</span>
            <span class="n">rezolveSdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
                <span class="nv">accessToken</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> 
                <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> 
                <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
                <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">session</span> <span class="k">in</span>

                    <span class="k">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="n">productResultDelegate</span> <span class="o">=</span> <span class="k">self</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">session</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span><span class="o">.</span><span class="nf">startVideoScan</span><span class="p">(</span><span class="nv">scanCameraView</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="k">as!</span> <span class="kt">ScanCameraView</span><span class="p">)</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">401</span> <span class="p">{</span> <span class="c1">// Invalid token return</span>
                    <span class="c1">// Developer shoud put token refreshing logic</span>
                    <span class="c1">// using `credentials/ping` endpoint</span>
                <span class="p">}</span>

                   <span class="c1">// Handle other errors</span>
           <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="kd">func</span> <span class="nf">onError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// handle error</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onStartRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: show a loading indicator</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onFinishRecognizeImage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

      <span class="c1">// suggestion: alert user with some sound</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onProductResult</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="c1">// If category hasCategories, fetch children categories (onCategoryResult)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">getCategories</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">categoryId</span><span class="p">:</span> <span class="n">category</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">category</span> <span class="k">in</span>

        <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span>

          <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// handle error</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryProductsResult</span><span class="p">(</span><span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">,</span> <span class="nv">productsPage</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="p">{</span>

    <span class="c1">// If category hasProducts, get product info (onCategoryProductsResult)</span>
        <span class="k">let</span> <span class="nv">pageNavigation</span><span class="p">:</span> <span class="kt">PageNavigation</span> <span class="o">=</span> <span class="kt">PageNavigation</span><span class="p">(</span><span class="nv">count</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">pageIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">sortBy</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">sort</span><span class="p">:</span> <span class="kt">PageNavigationSort</span><span class="o">.</span><span class="kt">ASC</span><span class="p">)</span>

        <span class="n">session</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">getProducts</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> <span class="nv">categoryId</span><span class="p">:</span> <span class="n">category</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nv">pageNavigation</span><span class="p">:</span> <span class="n">pageNavigation</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">pageResult</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>

        <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ScanManagerInterface</span><span class="o">,</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="c1">// set scan view</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">scan_activity</span><span class="o">);</span>
        <span class="n">rezolveScanView</span> <span class="o">=</span> <span class="o">(</span><span class="n">RezolveScanView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">scan_view</span><span class="o">);</span>

        <span class="c1">//get scan manager</span>
        <span class="n">scanManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getScanManager</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

          <span class="c1">//start video scan to acquire image</span>
          <span class="n">scanManager</span><span class="o">.</span><span class="na">startVideoScan</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">rezolveScanView</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="c1">// if scan media contains a category link, onCategoryResult fires and</span>
    <span class="c1">// returns a Category object. Parse the category object to obtain </span>
    <span class="c1">// a list of products in that category, and a list of subcategories of that category</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCategoryResult</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">category_id</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">parentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasProduct</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">image</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageThumbs</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">catParentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategories</span><span class="o">();</span>

        <span class="c1">// get category placement</span>
        <span class="n">Placement</span><span class="o">.</span><span class="na">CategoryPlacement</span> <span class="n">categoryPlacement</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategoryPlacement</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">categoryAdId</span> <span class="o">=</span> <span class="n">categoryPlacement</span><span class="o">.</span><span class="na">getAdId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">categoryPlacementId</span> <span class="o">=</span> <span class="n">categoryPlacement</span><span class="o">.</span><span class="na">getPlacementId</span><span class="o">();</span>

        <span class="c1">// optional:  get paginated subcategory results</span>
        <span class="n">PageResult</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categoryPageResult</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategoryPageResult</span><span class="o">();</span>

        <span class="c1">// optional: get paginated product results</span>
        <span class="n">PageResult</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">pageResult</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProductPageResult</span><span class="o">();</span>

        <span class="c1">// get products from pageResult...</span>
        <span class="n">Integer</span> <span class="n">count</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
        <span class="n">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">Link</span><span class="o">[]</span> <span class="n">links</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getLinks</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">displayProducts</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getItems</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Link</span> <span class="nl">link:</span> <span class="n">links</span><span class="o">){</span>
            <span class="n">Integer</span> <span class="n">linkcount</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
            <span class="n">Integer</span> <span class="n">page</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSort</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sortBy</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSortBy</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">DisplayProduct</span> <span class="n">displayProduct</span> <span class="o">:</span> <span class="n">displayProducts</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">DPid</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">DPimageThumbs</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPimage</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
            <span class="kt">float</span> <span class="n">DPprice</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPname</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPcategoryId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
<p>First, initialize <code>scanManager</code>, and enable the scan screen using <code>session.startVideo()</code>, and capture a watermarked image. The scanManager returns a <code>Category</code> object, which is then parsed to determine its contents.</p>
<h3 id='2-repeat-for-navigation-until-ready-to-purchase'>2. Repeat for navigation until ready to purchase</h3>
<p>Repeat step 1 above as the consumer browses through categories. Once the consumer selects a product and is ready to purchase, the process is the same as in the Instant Buy or Cart Buy flows. Note: a DisplayProduct does not contain full information on a product. You will need to call getProduct to display the detail view of the Product.</p>

          <h2 id='mall-flow'>Mall flow</h2>
<p><img src="images/wsd-jwt-mall-flow.png" style="margin:6px 0;"><br/>[ <a href="images/wsd-jwt-mall-flow.png" target="_blank">View full size</a> ]</p>

<p>Mall is the only method for finding products that does not require an ad scan. A consumer enters the mall by clicking on a &quot;Mall&quot; navigation option within the mobile app. The Mall showcases active merchants in an attractive layout that is condusive to casual browsing and subsequent purchasing. </p>

<p>Once a merchant is selected, the consumer shifts into category/product browse mode. Once a product has been selected, purchasing follows one of the previous examples of Instant Buy Flow or Cart Buy Flow (minus the scan step).</p>
<h4 id='1-get-list-of-merchants-in-the-mall'>1. Get List of Merchants in the mall</h4><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">RezolveSDK</span>
<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">internal</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">ApiClient</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">rezolveSdk</span><span class="p">:</span> <span class="kt">RezolveSDK</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">getMerchants</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">self</span><span class="o">.</span><span class="n">rezolveSdk</span><span class="p">?</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
            <span class="nv">accessToken</span><span class="p">:</span> <span class="n">accessToken</span><span class="p">,</span>
            <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span>
            <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
            <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">rezolveSession</span> <span class="k">in</span>

                <span class="n">rezolveSession</span><span class="o">.</span><span class="n">merchantManager</span><span class="o">.</span><span class="nf">getMerchants</span><span class="p">(</span>
                    <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">listOfMerchant</span> <span class="k">in</span>

                        <span class="n">listOfMerchant</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">tagline</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">banner</span><span class="p">)</span>

                            <span class="nv">$0</span><span class="o">.</span><span class="n">bannerThumbs</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">thumb</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">thumb</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">logo</span><span class="p">)</span>
                            <span class="nv">$0</span><span class="o">.</span><span class="n">logoThumbs</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">logo</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">termsAndConditions</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">contactInformation</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> 
                        <span class="c1">// Handle Errors</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Merchants</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">MerchantInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">MerchantInterface</span> <span class="n">merchantInterface</span><span class="o">;</span>

        <span class="n">MerchantManager</span> <span class="n">merchantManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getMerchantManager</span><span class="o">();</span>

        <span class="c1">// get merchants</span>
        <span class="n">merchantManager</span><span class="o">.</span><span class="na">getMerchants</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onGetMerchantsSuccess</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Merchant</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Merchant</span> <span class="n">merchant</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">merchant_id</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">tagline</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getTagline</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">banner</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getBanner</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">bannerThumbs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getBannerThumbs</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">logoThumbs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getLogoThumbs</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>First, initialize <code>MerchantManager</code>, and call <code>GetMerchants</code>, providing an implementation of MerchantCallback as a parameter. This will return an array of Merchant objects. Parse each merchant object to get the <code>id</code>, <code>name</code>, <code>tagline</code>, <code>banner</code>, <code>bannerThumbs</code>, and <code>logoThumbs</code>.</p>
<h3 id='2-get-list-of-first-level-categories-for-the-selected-merchant'>2. Get list of first-level Categories for the selected Merchant</h3><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="k">let</span> <span class="nv">MERCHANT_ID</span> <span class="o">=</span> <span class="s">"12"</span>
<span class="k">let</span> <span class="nv">CATEGORY_ID</span> <span class="o">=</span> <span class="kt">Int32</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">sdk</span><span class="p">:</span> <span class="kt">RezolveSDK</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="kt">API_KEY</span><span class="p">,</span> <span class="nv">env</span><span class="p">:</span> <span class="kt">SDK_ENV</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">signUpRequest</span> <span class="o">=</span> <span class="nf">createSingUpRequest</span><span class="p">()</span>

        <span class="n">sdk</span><span class="o">.</span><span class="nf">registerUser</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">partnerId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">entityId</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">in</span>

            <span class="n">sdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span><span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> <span class="nv">device</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">)</span> <span class="k">in</span>

                <span class="c1">// CATEGORY_ID should be null</span>
                <span class="n">session</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">getCategories</span><span class="p">(</span>
                    <span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> 
                    <span class="nv">category</span><span class="p">:</span> <span class="kt">Category</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">CATEGORY_ID</span><span class="p">),</span> 
                    <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">responseCategory</span> <span class="k">in</span>

                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">parentId</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">imageThumbs</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">hasProducts</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">hasCategories</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">responseCategory</span><span class="o">.</span><span class="n">hasCategories</span> <span class="p">{</span>                     
                            <span class="n">responseCategory</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">subCategories</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">parentId</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                                <span class="c1">// ...</span>
                            <span class="p">}</span>   
                        <span class="p">}</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// handle error</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">ProductInterface</span> <span class="n">productInterface</span><span class="o">;</span>

    <span class="n">ProductManager</span> <span class="n">myProductManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getProductManager</span><span class="o">();</span>

    <span class="c1">// get categories</span>
    <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>
    <span class="n">myProductManager</span><span class="o">.</span><span class="na">getCategories</span><span class="o">(</span><span class="n">merchantId</span><span class="o">,</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onGetCategoriesSuccess</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// parse Category object </span>
    <span class="n">String</span> <span class="n">category_id</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">parentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="n">Boolean</span> <span class="n">hasCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
    <span class="n">Boolean</span> <span class="n">hasProduct</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">image</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageThumbs</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">catParentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategories</span><span class="o">();</span>
    <span class="n">PageResult</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">pageResult</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProductPageResult</span><span class="o">();</span>

    <span class="c1">// get products from pageResult...</span>
    <span class="n">Integer</span> <span class="n">count</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
    <span class="n">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
    <span class="n">Link</span><span class="o">[]</span> <span class="n">links</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getLinks</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">displayProducts</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getItems</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">Link</span> <span class="nl">link:</span> <span class="n">links</span><span class="o">){</span>
        <span class="n">Integer</span> <span class="n">linkcount</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
        <span class="n">Integer</span> <span class="n">page</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSort</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">sortBy</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSortBy</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">DisplayProduct</span> <span class="n">displayProduct</span> <span class="o">:</span> <span class="n">displayProducts</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">DPid</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">DPimageThumbs</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">DPimage</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">DPprice</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">DPname</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">DPcategoryId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
<p>Display your subcategories and products as returned by the <code>getCategories</code> call. </p>

<p>For subsequent navigation in categories, use <code>getProductsAndCategories</code>.</p>
<h3 id='3-if-the-consumer-clicks-a-subcategory-call-getproductsandcategories'>3. If the consumer clicks a subcategory, call <code>getProductsAndCategories</code>.</h3><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="k">let</span> <span class="nv">MERCHANT_ID</span> <span class="o">=</span> <span class="s">"12"</span>
<span class="k">let</span> <span class="nv">CATEGORY_ID</span> <span class="o">=</span> <span class="kt">Int32</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">sdk</span><span class="p">:</span> <span class="kt">RezolveSDK</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="kt">API_KEY</span><span class="p">,</span> <span class="nv">env</span><span class="p">:</span> <span class="kt">SDK_ENV</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">signUpRequest</span> <span class="o">=</span> <span class="nf">createSingUpRequest</span><span class="p">()</span>

        <span class="n">sdk</span><span class="o">.</span><span class="nf">registerUser</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">partnerId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">entityId</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">in</span>

            <span class="n">sdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span><span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> <span class="nv">device</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">)</span> <span class="k">in</span>

                <span class="n">session</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">getProductsAndCatgories</span><span class="p">(</span>
                    <span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> 
                    <span class="nv">category</span><span class="p">:</span> <span class="kt">Category</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="kt">CATEGORY_ID</span><span class="p">),</span> 
                    <span class="nv">pageNavigationFilter</span><span class="p">:</span> <span class="kt">PageNavigationFilter</span><span class="p">(</span>
                        <span class="nv">count</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> 
                        <span class="nv">pageIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="nv">sortBy</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> 
                        <span class="nv">sort</span><span class="p">:</span> <span class="kt">PageNavigationSort</span><span class="o">.</span><span class="kt">DESC</span>
                    <span class="p">),</span>
                    <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="n">responseCategory</span> <span class="k">in</span>

                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">parentId</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">imageThumbs</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">hasProducts</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">responseCategory</span><span class="o">.</span><span class="n">hasCategories</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">responseCategory</span><span class="o">.</span><span class="n">hasCategories</span> <span class="p">{</span>                     
                            <span class="n">responseCategory</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">subCategories</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">parentId</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">subCategories</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                                <span class="c1">// ...</span>
                            <span class="p">}</span>   
                        <span class="p">}</span>


                        <span class="k">if</span> <span class="k">let</span> <span class="nv">resultOfCategory</span> <span class="o">=</span> <span class="n">pageResultOfCategory</span> <span class="p">{</span>

                            <span class="n">resultOfCategory</span><span class="o">.</span><span class="n">embedded</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">embeddedCategory</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">parentId</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">imageThumbs</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedCategory</span><span class="o">.</span><span class="n">hasProducts</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">embeddedCategory</span><span class="o">.</span><span class="n">hasCategories</span> <span class="p">{</span>
                                    <span class="c1">// ..</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="k">let</span> <span class="nv">resultOfProduct</span> <span class="o">=</span> <span class="n">pageResultOfProduct</span> <span class="p">{</span>
                            <span class="n">resultOfProduct</span><span class="o">.</span><span class="n">embedded</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">embeddedProduct</span> <span class="k">in</span>

                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">merchantId</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">subtitle</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

                                <span class="n">embeddedProduct</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
                                <span class="p">}</span>

                                <span class="n">embeddedProduct</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">option</span> <span class="k">in</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">extraInfo</span><span class="p">)</span>
                                    <span class="n">option</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">optionValue</span> <span class="k">in</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">optionValue</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">optionValue</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>

                                <span class="n">embeddedProduct</span><span class="o">.</span><span class="n">optionAvailable</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                                    <span class="nv">$0</span><span class="o">.</span><span class="n">combination</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">variant</span> <span class="k">in</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
                                    <span class="p">}</span>
                                <span class="p">}</span> 

                                <span class="n">embeddedProduct</span><span class="o">.</span><span class="n">customOptions</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">isRequire</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">optionId</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">sortOrder</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">optionType</span><span class="p">)</span>

                                    <span class="nv">$0</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> 
                                        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">sortOrder</span><span class="p">)</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                        <span class="nf">print</span><span class="p">(</span><span class="n">valueId</span><span class="p">)</span>
                                    <span class="p">}</span>

                                    <span class="nv">$0</span><span class="o">.</span><span class="n">valuesId</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">valueId</span> <span class="k">in</span> 
                                        <span class="nf">print</span><span class="p">(</span><span class="n">valueId</span><span class="p">)</span>
                                    <span class="p">}</span>

                                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                                <span class="p">}</span>

                                <span class="nf">print</span><span class="p">(</span><span class="n">embeddedProduct</span><span class="o">.</span><span class="n">productPlacement</span><span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// handle error</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Products2</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ProductInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">ProductInterface</span> <span class="n">productInterface</span><span class="o">;</span>

        <span class="n">ProductManager</span> <span class="n">myProductManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getProductManager</span><span class="o">();</span>

        <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Category</span><span class="o">();</span>

        <span class="c1">// first pageNavigationFilter is for categories</span>
        <span class="n">PageNavigationFilter</span> <span class="n">pageNavigationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageNavigationFilter</span><span class="o">();</span>
        <span class="n">pageNavigationFilter</span><span class="o">.</span><span class="na">setItemsPerPage</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="n">pageNavigationFilter</span><span class="o">.</span><span class="na">setPageNumber</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">pageNavigationFilter</span><span class="o">.</span><span class="na">setSortBy</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>   <span class="c1">// values: name, price</span>
        <span class="n">pageNavigationFilter</span><span class="o">.</span><span class="na">setSortDirection</span><span class="o">(</span><span class="s">"asc"</span><span class="o">);</span>  <span class="c1">// values: asc, desc</span>
        <span class="c1">// second pageNavigationFilter is for products</span>
        <span class="n">PageNavigationFilter</span> <span class="n">pageNavigationFilter2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageNavigationFilter</span><span class="o">();</span>
        <span class="n">pageNavigationFilter2</span><span class="o">.</span><span class="na">setItemsPerPage</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
        <span class="n">pageNavigationFilter2</span><span class="o">.</span><span class="na">setPageNumber</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">pageNavigationFilter2</span><span class="o">.</span><span class="na">setSortBy</span><span class="o">(</span><span class="s">"price"</span><span class="o">);</span>   <span class="c1">// values: name, price</span>
        <span class="n">pageNavigationFilter2</span><span class="o">.</span><span class="na">setSortDirection</span><span class="o">(</span><span class="s">"asc"</span><span class="o">);</span>  <span class="c1">// values: asc, desc</span>

        <span class="c1">// get products and categories in one call</span>
        <span class="n">myProductManager</span><span class="o">.</span><span class="na">getProductsAndCategories</span><span class="o">(</span><span class="n">merchantId</span><span class="o">,</span> <span class="n">category</span><span class="o">,</span> <span class="n">pageNavigationFilter</span><span class="o">,</span> <span class="n">pageNavigationFilter2</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onGetProductsAndCategoriesSuccess</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">category_id</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">parentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasProduct</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">image</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageThumbs</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">catParentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategories</span><span class="o">();</span>
        <span class="n">PageResult</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">pageResult</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProductPageResult</span><span class="o">();</span>

        <span class="c1">// get products from pageResult...</span>
        <span class="n">Integer</span> <span class="n">count</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
        <span class="n">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">Link</span><span class="o">[]</span> <span class="n">links</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getLinks</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">displayProducts</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getItems</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Link</span> <span class="nl">link:</span> <span class="n">links</span><span class="o">){</span>
            <span class="n">Integer</span> <span class="n">linkcount</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
            <span class="n">Integer</span> <span class="n">page</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSort</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sortBy</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSortBy</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">DisplayProduct</span> <span class="n">displayProduct</span> <span class="o">:</span> <span class="n">displayProducts</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">DPid</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">DPimageThumbs</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPimage</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
            <span class="kt">float</span> <span class="n">DPprice</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPname</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPcategoryId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>As the consumer navigates the category tree, call <code>getProductsAndCategories</code> to pull a paginated lists of subcategories and products for that category.</p>
<h3 id='4-if-the-consumer-clicks-a-product-call-getproduct'>4. If the consumer clicks a Product, call <code>getProduct</code></h3><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="k">let</span> <span class="nv">MERCHANT_ID</span> <span class="o">=</span> <span class="s">"12"</span>
<span class="k">let</span> <span class="nv">CATEGORY_ID</span> <span class="o">=</span> <span class="kt">Int32</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">PRODUCT_ID</span> <span class="o">=</span> <span class="s">"6"</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">sdk</span><span class="p">:</span> <span class="kt">RezolveSDK</span> <span class="o">=</span> <span class="kt">RezolveSDK</span><span class="p">(</span><span class="nv">apiKey</span><span class="p">:</span> <span class="kt">API_KEY</span><span class="p">,</span> <span class="nv">env</span><span class="p">:</span> <span class="kt">SDK_ENV</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">signUpRequest</span> <span class="o">=</span> <span class="nf">createSingUpRequest</span><span class="p">()</span>

        <span class="n">sdk</span><span class="o">.</span><span class="nf">registerUser</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">partnerId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">entityId</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="k">in</span>

            <span class="n">sdk</span><span class="o">.</span><span class="nf">createSession</span><span class="p">(</span>
                <span class="nv">entityId</span><span class="p">:</span> <span class="n">entityId</span><span class="p">,</span> 
                <span class="nv">partnerId</span><span class="p">:</span> <span class="n">partnerId</span><span class="p">,</span> 
                <span class="nv">device</span><span class="p">:</span> <span class="n">signUpRequest</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> 
                <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">)</span> <span class="k">in</span>

                <span class="n">session</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">getProduct</span><span class="p">(</span>
                    <span class="nv">merchantId</span><span class="p">:</span> <span class="kt">MERCHANT_ID</span><span class="p">,</span> 
                    <span class="nv">categoryId</span><span class="p">:</span> <span class="kt">CATEGORY_ID</span><span class="p">,</span> 
                    <span class="nv">productId</span><span class="p">:</span> <span class="kt">PRODUCT_ID</span><span class="p">,</span> 
                    <span class="nv">callback</span><span class="p">:</span>  <span class="p">{</span> <span class="n">product</span> <span class="k">in</span>

                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">merchantId</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">subtitle</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

                        <span class="n">product</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
                        <span class="p">}</span>

                        <span class="n">product</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">option</span> <span class="k">in</span>
                            <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">extraInfo</span><span class="p">)</span>
                            <span class="n">option</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">optionValue</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">optionValue</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">optionValue</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="n">product</span><span class="o">.</span><span class="n">optionAvailable</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                            <span class="nv">$0</span><span class="o">.</span><span class="n">combination</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">variant</span> <span class="k">in</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span> 

                        <span class="n">product</span><span class="o">.</span><span class="n">customOptions</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">isRequire</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">optionId</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">sortOrder</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">optionType</span><span class="p">)</span>

                            <span class="nv">$0</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span> 
                                <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">sortOrder</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
                                <span class="nf">print</span><span class="p">(</span><span class="n">valueId</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nv">$0</span><span class="o">.</span><span class="n">valuesId</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">valueId</span> <span class="k">in</span> 
                                <span class="nf">print</span><span class="p">(</span><span class="n">valueId</span><span class="p">)</span>
                            <span class="p">}</span>

                            <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                        <span class="p">}</span>

                        <span class="nf">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">productPlacement</span><span class="p">)</span>

                <span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span>

                    <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// handle error</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// get a single product using ProductInterface</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Products</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">ProductInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

        <span class="n">ProductManager</span> <span class="n">myProductManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getProductManager</span><span class="o">();</span>

        <span class="c1">// get single product</span>
        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">();</span>
        <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Category</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>

        <span class="n">myProductManager</span><span class="o">.</span><span class="na">getProduct</span><span class="o">(</span><span class="n">merchantId</span><span class="o">,</span> <span class="n">category</span><span class="o">,</span> <span class="n">product</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onGetProductSuccess</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">rezolve</span><span class="o">.</span><span class="na">sdk</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">shop</span><span class="o">.</span><span class="na">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// get product info</span>
        <span class="n">String</span> <span class="n">product_id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">subtitle</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getDescription</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">images</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getImages</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;</span> <span class="n">thumbs</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">merchant_id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getMerchantId</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Option</span><span class="o">&gt;</span> <span class="n">options</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getOptions</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Variant</span><span class="o">&gt;</span> <span class="n">optionsAvail</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getOptionsAvailable</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CustomOption</span><span class="o">&gt;</span> <span class="n">customOptions</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getCustomOptions</span><span class="o">();</span>


        <span class="c1">// iterate to get values of options list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Option</span> <span class="n">option</span> <span class="o">:</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">optionLabel</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">extraInfo</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getExtraInfo</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">optionCode</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">OptionValue</span><span class="o">&gt;</span> <span class="n">optionValues</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getValues</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="n">OptionValue</span> <span class="nl">optionValue:</span> <span class="n">optionValues</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">optionValue</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">label</span> <span class="o">=</span> <span class="n">optionValue</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// iterate to get values of variant list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Variant</span> <span class="n">variant</span> <span class="o">:</span> <span class="n">optionsAvail</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Combination</span><span class="o">&gt;</span> <span class="n">combinations</span> <span class="o">=</span> <span class="n">variant</span><span class="o">.</span><span class="na">getCombinations</span><span class="o">();</span>
            <span class="c1">// iterate to get values of composition hashmap</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Combination</span> <span class="n">combination</span> <span class="o">:</span> <span class="n">combinations</span> <span class="o">){</span>
                <span class="n">String</span> <span class="n">comboValue</span> <span class="o">=</span> <span class="n">combination</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">comboCode</span> <span class="o">=</span> <span class="n">combination</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//iterate to get values of CustomOptions list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">CustomOption</span> <span class="n">customOption</span> <span class="o">:</span> <span class="n">customOptions</span><span class="o">){</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">CustomOptionValue</span><span class="o">&gt;</span> <span class="n">customOptionValues</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getValues</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">customOptionId</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getOptionId</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">customOptionSortOrder</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getSortOrder</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">customOptiontitle</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
            <span class="n">Boolean</span> <span class="n">customOptionIsRequired</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">isRequired</span><span class="o">();</span>

            <span class="c1">// iterate to get values of customOptionValues</span>
            <span class="k">for</span><span class="o">(</span> <span class="n">CustomOptionValue</span> <span class="n">customOptionValue</span> <span class="o">:</span> <span class="n">customOptionValues</span> <span class="o">){</span>
                <span class="n">String</span> <span class="n">customOptionValueTitle</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">customOptionValuesSortOrder</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getSortOrder</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">customOptionValueId</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getValueId</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>If the consumer clicks a Product, call <code>getProduct</code> to fetch full product information. At this point, the user can either add the product to their cart, click &quot;buy now&quot;, or press &quot;back&quot; to navigate to the category view. </p>

          <h2 id='click-and-collect'>Click and Collect</h2>
<p>Click and Collect enables users to select products online, and pick them up in-store. The consumer may either pay online, or pay in-store.</p>

<p>Please note that your Resolve Commerce Engine must have Pick Up In Store enabled under the Advanced menu, for this option to apply. </p>

<p>The Click and Collect flow is no different from in the Cart Buy or Instant Buy examples, it is only the user-chosen values that change. </p>
<h4 id='1-choices-returned-by-paymentoptionmanager'>1. Choices returned by PaymentOptionManager</h4><pre class="highlight swift tab-swift"><code><span class="c1">// Fetches PaymentOption for Product</span>
<span class="n">rezolveSession</span><span class="o">.</span><span class="nf">getProductOptions</span><span class="p">(</span>
    <span class="nv">checkoutProduct</span><span class="p">:</span> <span class="n">checkoutProduct</span><span class="p">,</span>
    <span class="nv">merchantId</span><span class="p">:</span> <span class="n">merchantId</span><span class="p">,</span>
    <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">paymentOption</span><span class="p">:</span> <span class="kt">PaymentOption</span><span class="p">)</span> <span class="o">-&gt;</span>

    <span class="k">let</span> <span class="nv">paymentMethods</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedPaymentMethods</span>
    <span class="k">let</span> <span class="nv">shippings</span> <span class="o">=</span> <span class="n">paymentOption</span><span class="o">.</span><span class="n">supportedDeliveryMethods</span>

<span class="p">},</span> <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">httpResponse</span> <span class="k">in</span>
    <span class="c1">// Error handling</span>
<span class="p">})</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">paymentOptionManager</span><span class="o">.</span><span class="na">getProductOptions</span><span class="o">(</span><span class="n">checkoutProduct</span><span class="o">,</span> <span class="n">merchantId</span><span class="o">,</span> <span class="k">new</span> <span class="n">PaymentOptionCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductOptionsSuccess</span><span class="o">(</span><span class="n">PaymentOption</span> <span class="n">paymentOption</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setPaymentOption</span><span class="o">(</span><span class="n">paymentOption</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="kd">final</span> <span class="n">RezolveError</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">});</span>

</code></pre>
<p>When you call <code>PaymentOptionManager.getProductOptions</code>, it returns a list of your payment and shipment options.</p>
<h4 id='2-inspecting-the-returned-options'>2. Inspecting the returned options</h4><pre class="highlight plaintext"><code>{
  "type": "standard",
  "supported_shipping_methods": [
    {
      "execute": {
        "method_code": "flatrate",
        "manual_payment_label": "Pay on Collection",
        "extension_attributes": null,
        "display_name": "Fixed",
        "carrier_code": "flatrate"
      },
      "details": {
        "store_details": null
      }
    },
    {
      "execute": {
        "method_code": "storepickup",
        "manual_payment_label": "Pay on Collection",
        "extension_attributes": [
          {
            "value": "2",
            "code": "pickup_store"
          }
        ],
        "display_name": "Pickup In Store",
        "carrier_code": "storepickup"
      },
      "details": {
        "store_details": {
          "telephone": "01234456789",
          "pickup_store": 2,
          "opening_times": [

          ],
          "name": "Chao Yang Store",
          "location": {
            "longitude": 116.2573779,
            "latitude": 39.9390628
          },
          "email": "china2@storepickuptesting.com",
          "description": null,
          "address": {
            "street2": "",
            "street1": "14 Dongsuan Huan Beilu",
            "region": "Beijing",
            "post_code": "100026",
            "country": "\u00e4\u00b8\u00ad\u013a\u203a\u02dd",
            "city": "BEIJING"
          }
        }
      }
    },
    {
      "execute": {
        "method_code": "storepickup",
        "manual_payment_label": "Pay on Collection",
        "extension_attributes": [
          {
            "value": "1",
            "code": "pickup_store"
          }
        ],
        "display_name": "Pickup In Store",
        "carrier_code": "storepickup"
      },
      "details": {
        "store_details": {
          "telephone": "01234456789",
          "pickup_store": 1,
          "opening_times": [

          ],
          "name": "China Qingdao Shi Store",
          "location": {
            "longitude": 36.3867744,
            "latitude": 117.6466473
          },
          "email": "chinar@storepickuptesting.com",
          "description": null,
          "address": {
            "street2": "",
            "street1": "63 RENMIN LU",
            "region": "Shandong",
            "post_code": "266033",
            "country": "\u00e4\u00b8\u00ad\u013a\u203a\u02dd",
            "city": "QINGDAO SHI"
          }
        }
      }
    }
  ],
  "supported_payment_methods": [
    {
      "type": "union_pay",
      "data": {
        "supported_types": [

        ],
        "supported_shipping": [
          "storepickup",
          "flatrate"
        ],
        "supported_networks": [

        ],
        "requirements": {
          "rezolve_phone": true
        }
      }
    }
  ],
  "options": {

  },
  "id": "aa665b54-7166-4a53-a275-9b4f693770dc"
}
</code></pre>
<p>To the right is a sample of data returned by <code>PaymentOptionsManager.getProductOptions</code>. Look at the <code>supported_shipping_methods</code> node at the top of the file. If the list contains at least one child with <code>execute.method_code: storepickup</code> it means user can buy the product with Click and Collect. Every store where collecting the purchase is available will be listed as a separate item under <code>supported_shipping_methods</code>.</p>

<p>At this point the user should select a payment method. They are listed under the <code>supported_payment_methods</code> node. In some cases, like the example shown, there is one payment method available. In others, there might be more. For example, if <code>SupportedPaymentMethod has type: cash</code>, cash payment may only be allowed with Click and Collect and not in Delivery. To verify that we need <code>SupportedPaymentMethod</code> to be provided as an argument when creating a <code>DeliveryUnit</code>.</p>
<h4 id='3-creating-the-delivery-unit-delivery-method'>3. Creating the Delivery Unit/Delivery Method</h4><pre class="highlight swift tab-swift"><code>    <span class="c1">// standard shipping example</span>
    <span class="k">let</span> <span class="nv">delivery</span> <span class="o">=</span> <span class="kt">DeliveryMethod</span><span class="p">(</span><span class="nv">addressId</span><span class="p">:</span> <span class="n">addressObject</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1">// Click and Collect example</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">shipping</span> <span class="o">=</span> <span class="n">shippingMethod</span><span class="p">,</span> <span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="n">shipping</span><span class="o">.</span><span class="n">store</span> <span class="k">else</span> <span class="p">{</span> <span class="nf">preconditionFailure</span><span class="p">()</span> <span class="p">}</span>
    <span class="k">let</span> <span class="nv">deliveryMethod</span> <span class="o">=</span>  <span class="kt">DeliveryMethod</span><span class="p">(</span><span class="nv">addressId</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="s">"storepickup"</span><span class="p">)</span> 
    <span class="n">deliveryMethod</span><span class="o">.</span><span class="n">pickupStore</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">pickupStore</span><span class="p">)</span><span class="o">!</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// standard shipping example</span>
<span class="n">DeliveryUnit</span> <span class="n">deliveryUnit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DeliveryUnit</span><span class="o">(</span><span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">address</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

<span class="c1">// Click and Collect example</span>
<span class="n">DeliveryUnit</span> <span class="n">deliveryUnit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DeliveryUnit</span><span class="o">(</span><span class="n">supportedPaymentMethod</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">supportedDeliveryMethod</span><span class="o">.</span><span class="na">getShippingMethod</span><span class="o">().</span><span class="na">getExtensionAttributes</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getValue</span><span class="o">()));</span>
</code></pre>
<p>Android calls this object <code>DeliveryUnit</code>, IOS uses <code>DeliveryMethod</code></p>

<p><code>DeliveryUnit</code> (Android) is created using the chosen <code>supportedPaymentMethod</code> and the address id of the pick up store. </p>

<p><code>DeliveryMethod</code> (IOS) has no need of an id for the object creation, so an empty <code>String</code> used to feel the <code>addressId</code> present in the constructor.</p>

<p>See the <code>extension_attributes</code> node for this store id. </p>

<p><code>&quot;extension_attributes&quot;: [ { &quot;value&quot;: &quot;2&quot;, &quot;code&quot;: &quot;pickup_store&quot; } ]</code></p>

<p>Create the <code>DeliveryUnit</code>/<code>DeliveryMethod</code> as shown at right. </p>

<p><code>DeliveryUnit</code>/<code>DeliveryMethod</code> is then passed to create the <code>CheckoutBundleV2</code>, which is used to get totals before purchasing the product. </p>

          <h2 id='trigger-manager'>Trigger Manager</h2>
<p>Triggers are specially formatted media in the Rezolve system that can point to products, categories, and other resources. Image Engagements and Audio Engagements are a type of trigger, and these are handled by <code>ScanManager</code>. Touch Triggers are handled by <code>TriggerManager</code>. Touch Triggers are essentially URLs that are typically rendered as a touchable link or button onscreen. </p>

<p>Touch Triggers are used by the Background Listening feature to surface items detected from audio watermarks in a Background Listening session.</p>

<p>Touch Triggers could also be used to create a Wishlist feature; ask your sales person for the <em>Wishlist/Favorites Solution Paper</em>.</p>

<p>Trigger Manager provides a way to resolve touch triggers into actionable content, like products or categories. </p>

<p>Touch Engagements, or touch triggers, always have the same format: 
<code>http://rzlv.co/[partnerId]/[merchantId]/[categoryId]/[productId]?ad=[adId]&amp;placement=[placementId]</code></p>

<p>To use touch triggers, the partner should watch for urls in their content stream that match this pattern, render them as a touchable link, and then when touched, pass the url to the <code>TriggerManager.resolveTrigger method</code>. </p>
<h4 id='trigger-manager-example'>Trigger Manager Example</h4><pre class="highlight swift tab-swift"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="kd">class</span> <span class="kt">ScanManagerViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">var</span> <span class="nv">scanCameraView</span><span class="p">:</span> <span class="kt">ScanCameraView</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">mySession</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">//self.mySession = ... // initialize session</span>

        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://rzlv.co/1/2/3/8"</span><span class="p">)</span>

        <span class="k">self</span><span class="o">.</span><span class="n">mySession</span><span class="o">.</span><span class="n">triggerManager</span><span class="o">.</span><span class="nf">resolve</span><span class="p">(</span>
            <span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="o">!</span><span class="p">,</span>
            <span class="nv">productDelegate</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">onRezolveTriggerStart</span><span class="p">:</span> <span class="p">{},</span>
            <span class="nv">onRezolveTriggerEnd</span><span class="p">:</span> <span class="p">{},</span>
            <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">didReceiveMemoryWarning</span><span class="p">()</span>

        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="nf">stop</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">ProductDelegate</span> <span class="p">{</span>


    <span class="kd">func</span> <span class="nf">onStartRecognizeImage</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// will be renamed in the future to onStartRecognizeTrigger or similar</span>
        <span class="c1">// this fires when the trigger URL is sent for resolution by the Rezolve API. </span>
        <span class="c1">// could be used to start a waiting animation.</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onFinishRecognizeImage</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// will be renamed in the future to onFinishRecognizeTrigger or similar</span>
        <span class="c1">// this fires when a product, category, or error result is returned by the Rezolve API. </span>
        <span class="c1">// could be used to stop a waiting animation.</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onProductResult</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle product result</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryResult</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle category result</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryProductsResult</span><span class="p">(</span>
      <span class="nv">merchantId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
      <span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">,</span> <span class="nv">productsPage</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// will be ignored by trigger manager, touch triggers don't return this result type</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handle error</span>
    <span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TriggerMgr</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">TriggerInterface</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">TriggerManager</span> <span class="n">triggerManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getTriggerManager</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">triggerUrl</span> <span class="o">=</span> <span class="s">"http://rzlv.co/2/3/13/169?ad=20&amp;placement=25"</span><span class="o">;</span>

        <span class="n">triggerManager</span><span class="o">.</span><span class="na">resolveTrigger</span><span class="o">(</span> <span class="n">triggerUrl</span><span class="o">,</span> <span class="k">this</span> <span class="o">);</span>

        <span class="c1">// reserved for future functionality:</span>
        <span class="c1">// triggerManager.getPersistedTriggers();</span>
        <span class="c1">// triggerManager.listenUrl();</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductResult</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
<span class="c1">// get product info</span>
        <span class="n">String</span> <span class="n">product_id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">subtitle</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getSubtitle</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">description</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getDescription</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">images</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getImages</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;</span> <span class="n">thumbs</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">merchant_id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getMerchantId</span><span class="o">();</span>
        <span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Option</span><span class="o">&gt;</span> <span class="n">options</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getOptions</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Variant</span><span class="o">&gt;</span> <span class="n">optionsAvail</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getOptionsAvailable</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CustomOption</span><span class="o">&gt;</span> <span class="n">customOptions</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="na">getCustomOptions</span><span class="o">();</span>


        <span class="c1">// iterate to get values of options list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Option</span> <span class="n">option</span> <span class="o">:</span> <span class="n">options</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">optionLabel</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">extraInfo</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getExtraInfo</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">optionCode</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">OptionValue</span><span class="o">&gt;</span> <span class="n">optionValues</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="na">getValues</span><span class="o">();</span>

            <span class="k">for</span><span class="o">(</span><span class="n">OptionValue</span> <span class="nl">optionValue:</span> <span class="n">optionValues</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">optionValue</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">label</span> <span class="o">=</span> <span class="n">optionValue</span><span class="o">.</span><span class="na">getLabel</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// iterate to get values of variant list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Variant</span> <span class="n">variant</span> <span class="o">:</span> <span class="n">optionsAvail</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Combination</span><span class="o">&gt;</span> <span class="n">combinations</span> <span class="o">=</span> <span class="n">variant</span><span class="o">.</span><span class="na">getCombinations</span><span class="o">();</span>
            <span class="c1">// iterate to get values of composition hashmap</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Combination</span> <span class="n">combination</span> <span class="o">:</span> <span class="n">combinations</span> <span class="o">){</span>
                <span class="n">String</span> <span class="n">comboValue</span> <span class="o">=</span> <span class="n">combination</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">comboCode</span> <span class="o">=</span> <span class="n">combination</span><span class="o">.</span><span class="na">getCode</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">//iterate to get values of CustomOptions list</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">CustomOption</span> <span class="n">customOption</span> <span class="o">:</span> <span class="n">customOptions</span><span class="o">){</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">CustomOptionValue</span><span class="o">&gt;</span> <span class="n">customOptionValues</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getValues</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">customOptionId</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getOptionId</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">customOptionSortOrder</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getSortOrder</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">customOptiontitle</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
            <span class="n">Boolean</span> <span class="n">customOptionIsRequired</span> <span class="o">=</span> <span class="n">customOption</span><span class="o">.</span><span class="na">isRequired</span><span class="o">();</span>

            <span class="c1">// iterate to get values of customOptionValues</span>
            <span class="k">for</span><span class="o">(</span> <span class="n">CustomOptionValue</span> <span class="n">customOptionValue</span> <span class="o">:</span> <span class="n">customOptionValues</span> <span class="o">){</span>
                <span class="n">String</span> <span class="n">customOptionValueTitle</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getTitle</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">customOptionValuesSortOrder</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getSortOrder</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">customOptionValueId</span> <span class="o">=</span> <span class="n">customOptionValue</span><span class="o">.</span><span class="na">getValueId</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCategoryResult</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">category_id</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">parentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
        <span class="n">Boolean</span> <span class="n">hasProduct</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">image</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageThumbs</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">catParentId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getParentId</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getCategories</span><span class="o">();</span>
        <span class="n">PageResult</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">pageResult</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getProductPageResult</span><span class="o">();</span>

        <span class="c1">// get products from pageResult...</span>
        <span class="n">Integer</span> <span class="n">count</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
        <span class="n">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">Link</span><span class="o">[]</span> <span class="n">links</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getLinks</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">displayProducts</span> <span class="o">=</span> <span class="n">pageResult</span><span class="o">.</span><span class="na">getItems</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Link</span> <span class="nl">link:</span> <span class="n">links</span><span class="o">){</span>
            <span class="n">Integer</span> <span class="n">linkcount</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
            <span class="n">Integer</span> <span class="n">page</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSort</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">sortBy</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="na">getSortBy</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">DisplayProduct</span> <span class="n">displayProduct</span> <span class="o">:</span> <span class="n">displayProducts</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">DPid</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">DPimageThumbs</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPimage</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
            <span class="kt">float</span> <span class="n">DPprice</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPname</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">DPcategoryId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBadTrigger</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// called when provided url has bad syntax or is too short</span>
        <span class="c1">// handle error</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">HttpResponse</span> <span class="n">httpResponse</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// called if httpError occurs</span>
        <span class="c1">// handle error... available methods are:</span>
        <span class="c1">// httpResponse.getResponseJson();</span>
        <span class="c1">// httpResponse.getErrorList();</span>
        <span class="c1">// httpResponse.getStatusCode();</span>
        <span class="c1">// httpResponse.getResponseJson();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
          <h2 id='background-listening'>Background Listening</h2>
<p>Background Listening enables a mode where your app listens for watermarked audio, and rather than displaying the linked item immediately, instead stores any items it detects (products or categories) in a list. When background listening is stopped, the list is presented to the consumer as a series of Touch Triggers for review and action. As the name &quot;background listening&quot; implies, listening can occur in the background, such as when the consumer is using another app, or when the phone is asleep. Background listening will pause if interrupted by a phone call, and then resume afterwards. Background listening requires that sound be detected through the phone&#39;s mic. Watermarked audio playing in another app while headphones are plugged in would not be detected.</p>

<p>The implementation for Android and IOS are somewhat different, so see individual sequence diagrams below. </p>
<h3 id='ios-background-listening'>IOS Background Listening</h3>
<p><img src="images/BackgroundListeningIOS.png" style="margin:6px 0;"><br/>[ <a href="images/BackgroundListeningIOS.png" target="_blank">View full size</a> ]</p>
<h3 id='android-background-listening'>Android Background Listening</h3>
<p><img src="images/BackgroundListeningAndroid.png" style="margin:6px 0;"><br/>[ <a href="images/BackgroundListeningAndroid.png" target="_blank">View full size</a> ]</p>
<h4 id='1-start-background-listening-listen-and-display-results'>1. Start Background Listening, Listen, and Display Results</h4><pre class="highlight swift tab-swift"><code><span class="kt">Module</span><span class="p">:</span> <span class="kt">ScanManager</span> <span class="kt">Background</span> <span class="kt">Listening</span>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="kd">class</span> <span class="kt">ScanManagerViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">var</span> <span class="nv">scanCameraView</span><span class="p">:</span> <span class="kt">ScanCameraView</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">mySession</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">//self.mySession = ... // initialize session</span>

        <span class="k">let</span> <span class="nv">scanManager</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">mySession</span><span class="p">?</span><span class="o">.</span><span class="nf">getScanManager</span><span class="p">()</span>

        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="n">productResultDelegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="n">rezolveScanResultDelegate</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="n">autoDetectManagerDelegate</span> <span class="o">=</span> <span class="k">self</span>

        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="nf">startVideoScan</span><span class="p">(</span><span class="nv">scanCameraView</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">scanCameraView</span><span class="o">!</span><span class="p">)</span>
        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="nf">startAudioScan</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ScanViewController</span><span class="p">:</span> <span class="kt">AutoDetectManagerDelegate</span>
<span class="p">{</span>
    <span class="kd">func</span> <span class="nf">onAutoDetectStopListening</span><span class="p">(</span><span class="nv">resolved</span><span class="p">:</span> <span class="p">[</span><span class="kt">AutoDetectResult</span><span class="p">])</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span> <span class="s">"Auto Detect Results:</span><span class="se">\n</span><span class="s">"</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">current</span> <span class="k">in</span> <span class="n">resolved</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span> <span class="n">current</span><span class="o">.</span><span class="nf">description</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onAutoDetectError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span> <span class="s">"Auto Detect Error:</span><span class="se">\n</span><span class="s">"</span> <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span> <span class="n">error</span> <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rezolve</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">content</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.demo.utilities.Constants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.RezolveSDK</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.core.interfaces.AutoDetectInterface</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.core.managers.AutoDetectManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.model.shop.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.model.shop.Product</span><span class="o">;</span>

<span class="c1">// To use Rezolve Auto Detect, the main Activity of the app must implement AutoDetectInterface</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AutoDetectSampleActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">AutoDetectInterface</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">AutoDetectManager</span> <span class="n">rezolveAutoDetectManager</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// When app goes background the app should start the service</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">rezolveAutoDetectManager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Request RezolveSDK for a instance of the AutoDetectManager</span>
            <span class="n">rezolveAutoDetectManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getAutoDetectManager</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// Start the service passing the caller Activity, an optional notification and the AutoDetectInterface Callback.</span>
        <span class="c1">// Here we don't pass the optional notification, so the RezolveSDK will provide a default Notification for the app.</span>
        <span class="n">rezolveAutoDetectManager</span><span class="o">.</span><span class="na">startAutoDetectService</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">// When the app is resumed we must stop the service, on stoping the service will return result to the callback method.</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">rezolveAutoDetectManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">rezolveAutoDetectManager</span><span class="o">.</span><span class="na">stopAutoDetectService</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAutoDetectResults</span><span class="o">(</span><span class="n">List</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// On the callback method the app gets a heterogeneous list that may contain several types of Objects</span>
        <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">listSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">item</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">// The item may be a Product</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="k">instanceof</span> <span class="n">Product</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="o">(</span><span class="n">Product</span><span class="o">)</span> <span class="n">item</span><span class="o">;</span>
                    <span class="c1">// Or it may be a Pair containing a Category and the merchantId who owns the Category</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="k">instanceof</span> <span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="o">(</span><span class="n">Category</span><span class="o">)</span> <span class="o">((</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="n">item</span><span class="o">).</span><span class="na">first</span><span class="o">;</span>
                    <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="o">((</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="n">item</span><span class="o">).</span><span class="na">second</span><span class="o">;</span>

                    <span class="n">String</span> <span class="n">categoryId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                    <span class="n">String</span> <span class="n">categoryName</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                    <span class="kt">boolean</span> <span class="n">categoryHasProducts</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
                    <span class="kt">boolean</span> <span class="n">categoryHasSubCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<p>Use AutoDetectManagerDelegate (IOS) or AutoDetectManager (Android) to start listening for watermarked audio. When the user stops Background Listening, the results detected (if any) will be returned as an array. Iterate over this array to display detected items as Touch Triggers. </p>

<p>Note: if you want to enable &quot;back&quot; navigation to the item list after the consumer views a list item, you should persist the list in your code. The SDK only returns the list when AutoDetect is stopped; it does not persist the list for you. </p>
<h4 id='1a-note-that-android-offers-a-notification-helper'>1a. Note that Android offers a Notification Helper</h4><pre class="highlight java tab-java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">rezolve</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">content</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Notification</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.PendingIntent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Build</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v4.app.NotificationCompat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.support.v7.app.AppCompatActivity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.demo.R</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.demo.utilities.Constants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.RezolveSDK</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.core.interfaces.AutoDetectInterface</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.core.managers.AutoDetectManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.model.shop.Category</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.model.shop.Product</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rezolve.sdk.notifications.NotificationActionReceivers</span><span class="o">;</span>

<span class="c1">// To use Rezolve Auto Detect, the main Activity of the app must implement AutoDetectInterface</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AutoDetectSampleActivity2</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="kd">implements</span> <span class="n">AutoDetectInterface</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">AutoDetectManager</span> <span class="n">rezolveAutoDetectManager</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// We may create a custom notification to be used with the service</span>
        <span class="n">Notification</span> <span class="n">optionalCustomNotification</span> <span class="o">=</span> <span class="n">createOptionalNotification</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

        <span class="c1">// When app goes background the app should start the service</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">rezolveAutoDetectManager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">rezolveAutoDetectManager</span> <span class="o">=</span> <span class="n">RezolveSDK</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getRezolveSession</span><span class="o">().</span><span class="na">getAutoDetectManager</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// Start the service passing the caller Activity, an optional notification and the AutoDetectInterface Callback.</span>
        <span class="c1">// Here we send the custom notifiction we have created</span>
        <span class="n">rezolveAutoDetectManager</span><span class="o">.</span><span class="na">startAutoDetectService</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">optionalCustomNotification</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">// When the app is resumed we must stop the service, on stoping the service will return result to the callback method.</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">rezolveAutoDetectManager</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">rezolveAutoDetectManager</span><span class="o">.</span><span class="na">stopAutoDetectService</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAutoDetectResults</span><span class="o">(</span><span class="n">List</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// On the callback method the app gets a heterogeneous list that may contain several types of Objects</span>
        <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">listSize</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">item</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">// The item may be a Product</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="k">instanceof</span> <span class="n">Product</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="o">(</span><span class="n">Product</span><span class="o">)</span> <span class="n">item</span><span class="o">;</span>
                    <span class="c1">// Or it may be a Pair containing a Category and the merchantId who owns the Category</span>
                <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">item</span> <span class="k">instanceof</span> <span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="o">(</span><span class="n">Category</span><span class="o">)</span> <span class="o">((</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="n">item</span><span class="o">).</span><span class="na">first</span><span class="o">;</span>
                    <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="o">((</span><span class="n">android</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">v4</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Pair</span><span class="o">)</span> <span class="n">item</span><span class="o">).</span><span class="na">second</span><span class="o">;</span>

                    <span class="n">String</span> <span class="n">categoryId</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                    <span class="n">String</span> <span class="n">categoryName</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                    <span class="kt">boolean</span> <span class="n">categoryHasProducts</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasProducts</span><span class="o">();</span>
                    <span class="kt">boolean</span> <span class="n">categoryHasSubCategories</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="na">hasCategories</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Notification</span> <span class="nf">createOptionalNotification</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Here we create a regular notification to be presented by the service</span>
        <span class="n">String</span> <span class="n">CHANNEL_ID</span> <span class="o">=</span> <span class="s">"220518"</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">NOTIFICATION_ID</span> <span class="o">=</span> <span class="mi">230518</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">NOTIFICATION_TURN_OFF_REQUEST_CODE</span> <span class="o">=</span> <span class="mi">230519</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">ACTION_TURN_OFF</span> <span class="o">=</span> <span class="s">"action.turn.off"</span><span class="o">;</span>

        <span class="n">PendingIntent</span> <span class="n">onNotificationTapIntent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">Notification</span> <span class="n">notification</span><span class="o">;</span>
        <span class="n">Notification</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationBuilder</span><span class="o">;</span>
        <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">notificationCompatBuilder</span><span class="o">;</span>

        <span class="n">Intent</span> <span class="n">turnOffIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>

        <span class="n">turnOffIntent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">ACTION_TURN_OFF</span><span class="o">);</span>
        <span class="n">turnOffIntent</span><span class="o">.</span><span class="na">setClass</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">NotificationActionReceivers</span><span class="o">.</span><span class="na">TurnOffBackgroundListenerReceiver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">PendingIntent</span> <span class="n">pendingTurnOffIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getBroadcast</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">NOTIFICATION_TURN_OFF_REQUEST_CODE</span><span class="o">,</span> <span class="n">turnOffIntent</span><span class="o">,</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">FLAG_CANCEL_CURRENT</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">notificationBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Notification</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">CHANNEL_ID</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">default_notification_icon</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_title</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_text</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="k">new</span> <span class="n">Notification</span><span class="o">.</span><span class="na">BigTextStyle</span><span class="o">().</span><span class="na">bigText</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_big_text</span><span class="o">)))</span>
                    <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">spinner</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_turn_off</span><span class="o">),</span> <span class="n">pendingTurnOffIntent</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">onNotificationTapIntent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">onNotificationTapIntent</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">setOngoing</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">notification</span> <span class="o">=</span> <span class="n">notificationBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">notificationCompatBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">CHANNEL_ID</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_slider_head</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_title</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_text</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">BigTextStyle</span><span class="o">().</span><span class="na">bigText</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_big_text</span><span class="o">)))</span>
                    <span class="o">.</span><span class="na">setPriority</span><span class="o">(</span><span class="n">NotificationCompat</span><span class="o">.</span><span class="na">PRIORITY_DEFAULT</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">setAutoCancel</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAction</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">spinner</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">notification_turn_off</span><span class="o">),</span> <span class="n">pendingTurnOffIntent</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">onNotificationTapIntent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">notificationCompatBuilder</span><span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">onNotificationTapIntent</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="n">notificationCompatBuilder</span><span class="o">.</span><span class="na">setOngoing</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">notification</span> <span class="o">=</span> <span class="n">notificationCompatBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">notification</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
<p>This helper can be used to display notification to the user that Background Listening is active. </p>
<h4 id='2-display-item-consumer-selects-using-trigger-manager'>2. Display item Consumer selects using Trigger Manager</h4><pre class="highlight swift tab-swift"><code><span class="kt">Module</span><span class="p">:</span> <span class="kt">TriggerManager</span>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RezolveSDK</span>

<span class="kd">class</span> <span class="kt">ScanManagerViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">var</span> <span class="nv">scanCameraView</span><span class="p">:</span> <span class="kt">ScanCameraView</span><span class="p">?</span>

    <span class="k">var</span> <span class="nv">mySession</span><span class="p">:</span> <span class="kt">RezolveSession</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="c1">//self.mySession = ... // initialize session</span>

        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://rzlv.co/1/2/3/8?ad=20&amp;placement=25"</span><span class="p">)</span>

        <span class="k">self</span><span class="o">.</span><span class="n">mySession</span><span class="o">.</span><span class="n">triggerManager</span><span class="o">.</span><span class="nf">resolve</span><span class="p">(</span>
            <span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="o">!</span><span class="p">,</span>
            <span class="nv">productDelegate</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
            <span class="nv">onRezolveTriggerStart</span><span class="p">:</span> <span class="p">{},</span>
            <span class="nv">onRezolveTriggerEnd</span><span class="p">:</span> <span class="p">{},</span>
            <span class="nv">errorCallback</span><span class="p">:</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">didReceiveMemoryWarning</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">didReceiveMemoryWarning</span><span class="p">()</span>

        <span class="n">scanManager</span><span class="p">?</span><span class="o">.</span><span class="nf">stop</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">ProductDelegate</span> <span class="p">{</span>


    <span class="kd">func</span> <span class="nf">onStartRecognizeImage</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onFinishRecognizeImage</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onProductResult</span><span class="p">(</span><span class="nv">product</span><span class="p">:</span> <span class="kt">Product</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryResult</span><span class="p">(</span><span class="nv">merchantId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//display category result</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onCategoryProductsResult</span><span class="p">(</span>
      <span class="nv">merchantId</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
      <span class="nv">category</span><span class="p">:</span> <span class="kt">RezolveCategory</span><span class="p">,</span> <span class="nv">productsPage</span><span class="p">:</span> <span class="kt">PageResult</span><span class="o">&lt;</span><span class="kt">DisplayProduct</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//display product result</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onError</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="n">rezolveSession</span><span class="o">.</span><span class="na">getTriggerManager</span><span class="o">().</span><span class="na">resolveTrigger</span><span class="o">(</span><span class="s">"http://rzlv.co/2/3/13/169?ad=20&amp;placement=25"</span><span class="o">,</span> <span class="k">new</span> <span class="n">TriggerInterface</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProductResult</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// display prouduct result</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"resolveTrigger"</span><span class="o">,</span> <span class="s">"onProductResult: "</span><span class="o">+</span><span class="n">product</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCategoryResult</span><span class="o">(</span><span class="n">Category</span> <span class="n">category</span><span class="o">,</span> <span class="n">String</span> <span class="n">merchantId</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// display category result</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"resolveTrigger"</span><span class="o">,</span> <span class="s">"onCategoryResult: "</span><span class="o">+</span><span class="n">category</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onBadTrigger</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// called when provided url has bad syntax or is too short</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"resolveTrigger"</span><span class="o">,</span> <span class="s">"onBadTrigger"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="n">HttpResponse</span> <span class="n">httpResponse</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"resolveTrigger"</span><span class="o">,</span> <span class="s">"onError: "</span><span class="o">+</span><span class="n">httpResponse</span><span class="o">.</span><span class="na">getResponseJson</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>

</code></pre>
<p>Use TriggerManager to display a selected Touch Trigger item. You will have to pass a valid product url into TriggerManager, in the form:</p>

<p><code>http://rzlv.co/[partnerId]/[merchantId]/[categoryId]/[productId]?ad=[adId]&amp;placement=[placementId]</code></p>

<p>Get <code>partnerId</code>, <code>merchantId</code>, <code>categoryId</code>, <code>productId</code>, <code>adId</code> and <code>placmentId</code> from the returned list array for that item. If no <code>adId</code> and/or <code>placementId</code> are available, omit the <code>?ad=[adId]&amp;placement=[placementId]</code> part of the url (note that in this case, no stats will be gathered when this item is displayed or purchased).</p>

          <h2 id='act'>Act</h2>
<p>An Act is a type of consumer questionnaire that can be created in the Rezolve Commerce Engine. Acts are used to solicit information and collect consumer answers and contact information. No payment is required to submit an Act.</p>

<p>There is no specific data structure within the SDK that represents an Act; data-wise, it is a particular configuration of product that has no weight and no price. If your application receives a product with no weight and no price, you should display it as an Act. You do this by omitting certain information when displaying the item. You must do this in four places:</p>

<ul>
<li>The Product detail view</li>
<li>The Post-Purchase screen</li>
<li>The My Activity list view</li>
<li>The My Activity detail view</li>
</ul>
<h4 id='product-detail-view'>Product Detail View</h4>
<p>Remove price, quantity, payment details, delivery details, order summary, and the add-to-cart icon. Change the &quot;Instant Buy&quot; text to &quot;Act Now&quot;.</p>

<p><img src="images/product-view.png" style="margin:6px 0;"><br/>[ <a href="images/product-view.png" target="_blank">View full size</a> ]</p>
<h4 id='post-purchase-screen'>Post-Purchase Screen</h4>
<p>Omit quantity, price, payment details, delivery details, order summary, and pick-up-location map.</p>

<p><img src="images/post-purchase-view.png" style="margin:6px 0;"><br/>[ <a href="images/post-purchase-view.png" target="_blank">View full size</a> ]</p>
<h4 id='my-activity-list-view'>My Activity List View</h4>
<p>Omit the Order Total currency amounts from this screen. Change the order status text to &quot;submitted&quot;.</p>

<p><img src="images/my-activity-list.png" style="margin:6px 0;"><br/>[ <a href="images/my-activity-list.png" target="_blank">View full size</a> ]</p>
<h4 id='my-activity-detail-view'>My Activity Detail View</h4>
<p>Change &quot;Payment Successful&quot; header to &quot;Submitted&quot;. Remove &quot;order&quot; text from &quot;Your order ref:&quot;. Omit quantity, price, payment details, delivery details, order summary, pick-up-location map, and QR code area.</p>

<p><img src="images/my-activity-detail-view.png" style="margin:6px 0;"><br/>[ <a href="images/my-activity-detail-view.png" target="_blank">View full size</a> ]</p>

          <h2 id='merchant-and-product-search'>Merchant and Product Search</h2>
<p>Search is available to aid in the presentation and usability of large malls and/or large product catalogs. You can search for merchants, or for products.</p>
<h3 id='merchant-search'>Merchant Search</h3><pre class="highlight swift tab-swift"><code><span class="k">let</span> <span class="nv">searchData</span> <span class="o">=</span> <span class="kt">MerchantSearchData</span><span class="p">(</span>
    <span class="nv">orderBy</span><span class="p">:</span> <span class="o">.</span><span class="n">location</span><span class="p">,</span>
    <span class="nv">order</span><span class="p">:</span> <span class="o">.</span><span class="n">ascending</span><span class="p">,</span>
    <span class="nv">deviceInfo</span><span class="p">:</span> <span class="kt">DeviceInfo</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
    <span class="nv">location</span><span class="p">:</span> <span class="kt">RezolveLocation</span><span class="p">(</span><span class="nv">longitude</span><span class="p">:</span> <span class="o">-</span><span class="mf">73.9502622</span><span class="p">,</span> <span class="nv">latitude</span><span class="p">:</span> <span class="mf">40.6726499</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">let</span> <span class="nv">currentPage</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">let</span> <span class="nv">itemsLimit</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">rezolveSession</span><span class="p">?</span><span class="o">.</span><span class="n">merchantManager</span><span class="o">.</span><span class="nf">searchForMerchants</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">searchData</span><span class="p">,</span> <span class="nv">page</span><span class="p">:</span> <span class="n">currentPage</span><span class="p">,</span> <span class="nv">limit</span><span class="p">:</span> <span class="n">itemsLimit</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">merchantSearchResult</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Current state</span>
    <span class="k">let</span> <span class="nv">page</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="n">page</span>
    <span class="k">let</span> <span class="nv">total</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="n">total</span>

    <span class="k">let</span> <span class="nv">merchants</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="n">merchants</span>
    <span class="k">for</span> <span class="n">merchant</span> <span class="k">in</span> <span class="n">merchants</span> <span class="p">{</span>

        <span class="c1">// Base information</span>
        <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">id</span>
        <span class="k">let</span> <span class="nv">priority</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">priority</span>
        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">name</span>
        <span class="k">let</span> <span class="nv">tagLine</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">tagline</span>
        <span class="k">let</span> <span class="nv">distance</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">distance</span>

        <span class="c1">// Assets</span>
        <span class="k">let</span> <span class="nv">banner</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">banner</span>
        <span class="k">let</span> <span class="nv">bannerThumbs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">bannerThumbs</span>
        <span class="k">let</span> <span class="nv">logo</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">logo</span>
        <span class="k">let</span> <span class="nv">logoThumbs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">logoThumbs</span>

        <span class="c1">// Extra information</span>
        <span class="k">let</span> <span class="nv">info</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">contactInformation</span>
        <span class="k">let</span> <span class="nv">infoEmail</span> <span class="o">=</span> <span class="n">info</span><span class="p">?</span><span class="o">.</span><span class="n">email</span>
        <span class="k">let</span> <span class="nv">infoName</span> <span class="o">=</span> <span class="n">info</span><span class="p">?</span><span class="o">.</span><span class="n">name</span>
        <span class="k">let</span> <span class="nv">infoPhone</span> <span class="o">=</span> <span class="n">info</span><span class="p">?</span><span class="o">.</span><span class="n">phone</span>

        <span class="c1">// List of Stores</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">stores</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">stores</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">store</span> <span class="k">in</span> <span class="n">stores</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">id</span>
                <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">name</span>
                <span class="k">let</span> <span class="nv">location</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">location</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// List of Terms &amp; Conditions</span>
        <span class="k">let</span> <span class="nv">termsAndConditions</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="n">termsAndConditions</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">termsAndConditions</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
            <span class="k">let</span> <span class="nv">storeId</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">storeId</span>
            <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span>
            <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">content</span>
            <span class="k">let</span> <span class="nv">checkboxText</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">checkboxText</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle error gracefully</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// set up parameters for merchant search</span>
<span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
<span class="n">MerchantSearchOrderBy</span> <span class="n">merchantSearchOrderBy</span> <span class="o">=</span> <span class="n">MerchantSearchOrderBy</span><span class="o">.</span><span class="na">LOCATION</span><span class="o">;</span>
<span class="n">SearchDirection</span> <span class="n">searchDirection</span> <span class="o">=</span> <span class="n">SearchDirection</span><span class="o">.</span><span class="na">ASC</span><span class="o">;</span>
<span class="n">Integer</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">Integer</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
<span class="n">RezolveLocation</span> <span class="n">rezolveLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RezolveLocation</span><span class="o">();</span>
<span class="n">rezolveLocation</span><span class="o">.</span><span class="na">setLatitude</span><span class="o">(</span><span class="mf">40.6726499</span><span class="o">);</span>
<span class="n">rezolveLocation</span><span class="o">.</span><span class="na">setLongitude</span><span class="o">(-</span><span class="mf">73.9502622</span><span class="o">);</span>
<span class="n">MerchantSearchData</span> <span class="n">merchantSearchData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MerchantSearchData</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="n">merchantSearchOrderBy</span><span class="o">,</span><span class="n">searchDirection</span><span class="o">,</span><span class="n">offset</span><span class="o">,</span><span class="n">limit</span><span class="o">,</span><span class="n">rezolveLocation</span><span class="o">);</span>

<span class="c1">// set up merchant search interface and handle results</span>
<span class="n">MerchantSearchInterface</span> <span class="n">merchantSearchInterface</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MerchantSearchInterface</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSearchMerchantsSuccess</span><span class="o">(</span><span class="n">MerchantSearchResult</span> <span class="n">merchantSearchResult</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">page</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Merchant</span><span class="o">&gt;</span> <span class="n">merchants</span> <span class="o">=</span> <span class="n">merchantSearchResult</span><span class="o">.</span><span class="na">getMerchants</span><span class="o">();</span>

        <span class="c1">//iterate over merchants array</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Merchant</span> <span class="n">merchant</span> <span class="o">:</span> <span class="n">merchants</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">banner</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getBanner</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">bannerThumbs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getBannerThumbs</span><span class="o">();</span>
            <span class="n">Double</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getDistance</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">infoEmail</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getInfoEmail</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">infoName</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getInfoName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">infoPhone</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getInfoPhone</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">logo</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getLogo</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">logoThumgs</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getLogoThumbs</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">partnerId</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getPartnerId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">partnerName</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getPartnerName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">priority</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getPriority</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayStore</span><span class="o">&gt;</span> <span class="n">stores</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getStores</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">tagline</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getTagline</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">TermsAndConditions</span><span class="o">&gt;</span> <span class="n">termsAndConditionsList</span> <span class="o">=</span> <span class="n">merchant</span><span class="o">.</span><span class="na">getTermsAndConditionsList</span><span class="o">();</span>

            <span class="c1">// get list of store locations associated with this merchant</span>
            <span class="k">for</span><span class="o">(</span><span class="n">DisplayStore</span> <span class="nl">displayStore:</span><span class="n">stores</span><span class="o">){</span>
                 <span class="kt">int</span> <span class="n">storeId</span> <span class="o">=</span> <span class="n">displayStore</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                 <span class="n">RezolveLocation</span> <span class="n">storeLocation</span> <span class="o">=</span> <span class="n">displayStore</span><span class="o">.</span><span class="na">getLocation</span><span class="o">();</span>
                 <span class="n">String</span> <span class="n">storeName</span> <span class="o">=</span> <span class="n">displayStore</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="c1">// get terms of conditions for merchant</span>
            <span class="k">for</span><span class="o">(</span><span class="n">TermsAndConditions</span> <span class="n">termsAndConditions</span> <span class="o">:</span> <span class="n">termsAndConditionsList</span><span class="o">){</span>
                <span class="n">String</span> <span class="n">termsCheckboxText</span> <span class="o">=</span> <span class="n">termsAndConditions</span><span class="o">.</span><span class="na">getCheckboxText</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">termsContent</span> <span class="o">=</span> <span class="n">termsAndConditions</span><span class="o">.</span><span class="na">getContent</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">termsId</span> <span class="o">=</span> <span class="n">termsAndConditions</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">termsName</span> <span class="o">=</span> <span class="n">termsAndConditions</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
                <span class="n">String</span> <span class="n">termsStoreId</span> <span class="o">=</span> <span class="n">termsAndConditions</span><span class="o">.</span><span class="na">getStoreId</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">RezolveError</span> <span class="n">rezolveError</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle error gracefully</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="c1">// initiate merchant search</span>
<span class="n">merchantManager</span><span class="o">.</span><span class="na">searchMerchants</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="n">merchantSearchData</span><span class="o">,</span><span class="n">merchantSearchInterface</span><span class="o">);</span>
</code></pre>
<p>Merchant search offers the following features:</p>

<ul>
<li>The ability to list all merchants, sorted by distance to the end user.</li>
<li>The ability to enter a merchant name query, and sort results by Score or Distance.</li>
<li>Ability to order results ascending or descending.</li>
</ul>

<p>Note that to return merchants sorted by distance, each merchant in your ecosystem must configure at least one &quot;Store&quot; in the Merchant Portal, supplying latitude and longitude. Which ever merchant has a store closest to the user will be returned first.  </p>

<p>To search for a merchant you must supply the following parameters:</p>

<ul>
<li>Query string - Optional. Leave blank to get all merchants. If more than one term is supplied, terms are matched on an AND basis. </li>
<li>Offset - For pagination, offset is the number of pages of results to skip. Setting this to zero gets the first page of results.</li>
<li>Limit - For pagination, the number of results to return per page.</li>
<li>Sort By - Should merchants be sorted by LOCATION or by search SCORE.</li>
<li>Sort Direction - ASC or DESC</li>
<li>Location - Optional. The latitude and longitude of the consumer phone. Merchant list cannot be sorted by distance without this parameter.</li>
</ul>

<p>See code samples to the right.</p>
<h3 id='product-search'>Product Search</h3><pre class="highlight swift tab-swift"><code><span class="k">let</span> <span class="nv">productSearchData</span> <span class="o">=</span> <span class="kt">ProductSearchData</span><span class="p">(</span>
    <span class="nv">query</span><span class="p">:</span> <span class="s">"book"</span><span class="p">,</span>
    <span class="nv">merchantId</span><span class="p">:</span> <span class="s">"123"</span><span class="p">,</span>
    <span class="nv">orderBy</span><span class="p">:</span> <span class="o">.</span><span class="n">score</span><span class="p">,</span>
    <span class="nv">order</span><span class="p">:</span> <span class="o">.</span><span class="n">descending</span><span class="p">,</span>
    <span class="nv">location</span><span class="p">:</span> <span class="kt">RezolveLocation</span><span class="p">(</span><span class="nv">longitude</span><span class="p">:</span> <span class="o">-</span><span class="mf">73.9502622</span><span class="p">,</span> <span class="nv">latitude</span><span class="p">:</span> <span class="mf">40.6726499</span><span class="p">),</span>
    <span class="nv">includeInResults</span><span class="p">:</span> <span class="o">.</span><span class="n">products</span><span class="p">,</span>
    <span class="nv">deviceInfo</span><span class="p">:</span> <span class="kt">DeviceInfo</span><span class="o">.</span><span class="n">current</span>
<span class="p">)</span>
<span class="k">let</span> <span class="nv">currentPage</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">let</span> <span class="nv">itemsLimit</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">rezolveSession</span><span class="p">?</span><span class="o">.</span><span class="n">productManager</span><span class="o">.</span><span class="nf">searchForProducts</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">productSearchData</span><span class="p">,</span> <span class="nv">page</span><span class="p">:</span> <span class="n">currentPage</span><span class="p">,</span> <span class="nv">limit</span><span class="p">:</span> <span class="n">itemsLimit</span><span class="p">,</span> <span class="nv">callback</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">productSearchResult</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Current state</span>
    <span class="k">let</span> <span class="nv">page</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="n">page</span>
    <span class="k">let</span> <span class="nv">total</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="n">total</span>

    <span class="k">let</span> <span class="nv">products</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="n">products</span>
    <span class="k">for</span> <span class="n">product</span> <span class="k">in</span> <span class="n">products</span> <span class="p">{</span>
        <span class="c1">// Base information</span>
        <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span>
        <span class="k">let</span> <span class="nv">merchantId</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">merchantId</span>
        <span class="k">let</span> <span class="nv">merchantName</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">merchantName</span>
        <span class="k">let</span> <span class="nv">categoryId</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">categoryId</span>
        <span class="k">let</span> <span class="nv">categoryName</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">categoryName</span>
        <span class="k">let</span> <span class="nv">price</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">price</span>
        <span class="k">let</span> <span class="nv">isAct</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">isAct</span>
        <span class="k">let</span> <span class="nv">isVirtual</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">isVirtual</span>
        <span class="k">let</span> <span class="nv">hasRequiredOptions</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">hasRequiredOptions</span>

        <span class="c1">// Assets</span>
        <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">image</span>
        <span class="k">let</span> <span class="nv">imageThumbs</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">thumbs</span>
    <span class="p">}</span>

<span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">httpResponse</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle error gracefully</span>
<span class="p">}</span>
</code></pre><pre class="highlight java tab-java"><code><span class="c1">// set up parameters for product search</span>
<span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"book"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">merchantId2</span> <span class="o">=</span> <span class="s">"123"</span><span class="o">;</span>
<span class="n">ProductSearchOrderBy</span> <span class="n">productSearchOrderBy</span> <span class="o">=</span> <span class="n">ProductSearchOrderBy</span><span class="o">.</span><span class="na">SCORE</span><span class="o">;</span>
<span class="n">SearchDirection</span> <span class="n">searchDirection</span> <span class="o">=</span> <span class="n">SearchDirection</span><span class="o">.</span><span class="na">DESC</span><span class="o">;</span>
<span class="n">ProductType</span> <span class="n">productType</span> <span class="o">=</span> <span class="n">ProductType</span><span class="o">.</span><span class="na">ALL</span><span class="o">;</span>
<span class="n">Integer</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">Integer</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
<span class="n">RezolveLocation</span> <span class="n">rezolveLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RezolveLocation</span><span class="o">();</span>
<span class="n">rezolveLocation</span><span class="o">.</span><span class="na">setLatitude</span><span class="o">(</span><span class="mf">40.6726499</span><span class="o">);</span>
<span class="n">rezolveLocation</span><span class="o">.</span><span class="na">setLongitude</span><span class="o">(-</span><span class="mf">73.9502622</span><span class="o">);</span>
<span class="n">ProductSearchData</span> <span class="n">productSearchData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductSearchData</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="n">merchantId2</span><span class="o">,</span><span class="n">productSearchOrderBy</span><span class="o">,</span><span class="n">searchDirection</span><span class="o">,</span><span class="n">productType</span><span class="o">,</span><span class="n">offset</span><span class="o">,</span><span class="n">limit</span><span class="o">,</span><span class="n">rezolveLocation</span><span class="o">);</span>

<span class="c1">// set up product search interface and handle results</span>
<span class="n">ProductSearchInterface</span> <span class="n">productSearchInterface</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProductSearchInterface</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSearchProductsSuccess</span><span class="o">(</span><span class="n">ProductSearchResult</span> <span class="n">productSearchResult</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Integer</span> <span class="n">page</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="na">getPage</span><span class="o">();</span>
        <span class="n">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">DisplayProduct</span><span class="o">&gt;</span> <span class="n">displayProducts</span> <span class="o">=</span> <span class="n">productSearchResult</span><span class="o">.</span><span class="na">getDisplayProducts</span><span class="o">();</span>

        <span class="c1">// iterate over list of display proucts</span>
        <span class="k">for</span><span class="o">(</span><span class="n">DisplayProduct</span> <span class="nl">displayProduct:</span><span class="n">displayProducts</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">productId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">merchantId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getMerchantId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">categoryId</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">categoryName</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getCategoryName</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">image</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImage</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageThumbs</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getImageThumbs</span><span class="o">();</span>
            <span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
            <span class="n">Placement</span> <span class="n">productPlacement</span> <span class="o">=</span> <span class="n">displayProduct</span><span class="o">.</span><span class="na">getProductPlacement</span><span class="o">();</span>
            <span class="c1">// get product placement details</span>
            <span class="n">String</span> <span class="n">adId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getAdId</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">placementId</span> <span class="o">=</span> <span class="n">productPlacement</span><span class="o">.</span><span class="na">getPlacementId</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">RezolveError</span> <span class="n">rezolveError</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle error gracefully</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="c1">// initiate product search</span>
<span class="n">productManager</span><span class="o">.</span><span class="na">searchProducts</span><span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="n">productSearchData</span><span class="o">,</span> <span class="n">productSearchInterface</span><span class="o">);</span>
</code></pre>
<p>Product search offers the following features:</p>

<ul>
<li>Search products across all merchants in your ecosystem </li>
<li>Search the products of a single merchant (by specifying a merchant id)</li>
<li>Sort results by search SCORE or PRICE</li>
<li>Sort direction ASC or DESC</li>
</ul>

<p>To search for products you must supply the following parameters:</p>

<ul>
<li>Query string - Optional. Leaving blank will return all products. If more than one term is supplied, terms are matched on an AND basis. </li>
<li>Merchant Id - Optional. If supplied, restricts product search to the specified merchant.</li>
<li>Offset - For pagination, offset is the number of pages to skip. Setting this to zero gets the first page of results.</li>
<li>Limit - For pagination, the number of results to return per page.</li>
<li>Sort By - Sort by search SCORE or PRICE</li>
<li>Sort Direction - ASC or DESC</li>
<li>Product Type - Can be PRODUCTS, ACTS, or ALL.</li>
<li>Location - Optional. The latitude and longitude of the consumer phone.</li>
</ul>

<p>See code samples to the right.</p>

          <h1 id='error-handling'>Error Handling</h1><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"&lt;error_type&gt;"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"code"</span><span class="p">:</span><span class="s2">"&lt;error_code&gt;"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"&lt;error_message&gt;"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>All SDK methods use a uniform error format, as shown at the right. Possible values are:</p>

<table><thead>
<tr>
<th>Type</th>
<th>Error Code</th>
<th>Message</th>
</tr>
</thead><tbody>
<tr>
<td>Authentication</td>
<td>1</td>
<td>Access is denied.</td>
</tr>
<tr>
<td>Registration</td>
<td>2</td>
<td>Registration failed.</td>
</tr>
<tr>
<td>Bad Request</td>
<td>3</td>
<td>Missing required parameters in request body. Required: ((required_parameters))</td>
</tr>
<tr>
<td>Not Found</td>
<td>4</td>
<td>Requested resource not found</td>
</tr>
<tr>
<td>Bad Request</td>
<td>5</td>
<td>Incorrect or malformed parameters</td>
</tr>
<tr>
<td>Bad Request</td>
<td>6</td>
<td>((system message))</td>
</tr>
<tr>
<td>Service Unavailable</td>
<td>7</td>
<td>Our apologies for the temporary inconvenience. The requested URL generated 503 Service Unavailable error due to overloading or maintenance of the server.</td>
</tr>
</tbody></table>

          <h1 id='module-reference-docs'>Module Reference Docs</h1>
<p>Module reference docs are generated from commented source code.  IOS docs are generated using Jazzy (https://github.com/realm/jazzy) and Android docs are generated using Doxygen (http://www.doxygen.nl/).</p>

<p>The following links will open in a new window. Close the window to return to this documentation.</p>

<h3><a href="ios" target="_blank">IOS Module Documentation</a></h3>

<h3><a href="android/html" target="_blank">Android Module Documentation</a></h3>

          <h1 id='changelog'>Changelog</h1>
<p>All notable changes to the project will be documented in this log.</p>
<h2 id='ios-1-11-26-september-24-2019'>IOS 1.11.26 - September 24, 2019</h2>
<p>This release is IOS only.</p>
<h3 id='ios-changes'>IOS Changes</h3>
<ul>
<li>Compiled SDK with latest Xcode 11 &amp; Swift 5.1</li>
<li>Removed the need for having the new Mac Catalyst feature enabled</li>
</ul>
<h2 id='android-v2-1-0-ios-v1-11-25-june-26-2019'>Android v2.1.0, IOS v1.11.25 - June 26, 2019</h2><h3 id='documentation-changes'>Documentation Changes</h3>
<ul>
<li>Added tutorial for Search</li>
<li>New install instructions for IOS SDK (CocoaPods)</li>
<li>Updated module reference docs for both platforms</li>
</ul>
<h3 id='ios-changes-2'>IOS Changes</h3>
<ul>
<li>Added new method in Product Manager, <code>getAdditionalAttributes</code> </li>
<li>Added new method in Product Manager, allowing searching for products based on various criteria.</li>
<li>Added new method in Merchant Manager, allowing searching for merchants based on various criteria.</li>
<li>Added new, optional parameter fullName to Address object.</li>
<li>Added distance property to Merchant&#39;s model.</li>
<li>Added new property PriceOption to Product object.</li>
<li>Added option to suspend and resume the process of audio/video capturing during scan.</li>
<li>Added explicit handling of Act products with new is_act parameter on Product model.</li>
<li>Added new full_name parameter on Address model to dinstinguish from address_2.</li>
<li>Added phone_book_id parameter on Address model to allow for uniue Phone Number on each Address model.</li>
<li>Added getRootCategory endpoint, gets the root category for the selected merchant</li>
<li>Added getCartProduct added for fetching product information when there is no category</li>
<li>Added getMerchants endpoint, added optional parameter to fetch only active Merchants, represented as Bool<br/><br/></li>
<li>Updated getProducts</li>
<li>Updated PageResult&#39;s sorting direction now uses enum instead of string.</li>
<li>Updated getCategories endpoint </li>
<li>Misc bug fixes &amp; small optimizations</li>
</ul>
<h3 id='android-changes'>Android Changes</h3>
<ul>
<li>Added hashCode, equals implementation for CustomOption, OptionValue</li>
<li>Added toString implementation to CustomOption, OptionValue models</li>
<li>Added HttpClientConfig to RezolveSdk.Builder</li>
<li>Added missing interface to DisplayProduct.</li>
<li>Added default page navigation filter.</li>
<li>Added product and category ids.</li>
<li>Added a getter for scanned objects.</li>
<li>Added ScanManagerHelper.</li>
<li>Added .equal() methods for Placement and CheckoutProduct.</li>
<li>Added hashCode methods for CheckoutProduct and Placement.</li>
<li>Added missing flags to DisplayProduct.</li>
<li>Added equals and hashcode methods added for ConfigurableOption and CustomConfigurableOption.</li>
<li>Add visibility flag to the /merchant call.</li>
<li>Added CustomAttribute class.</li>
<li>Added Multiple Exception types catching in HttpClient.enqueueRequest to reduce code duplication</li>
<li>Added equals, hashCode and toString methods for PaymentCard.</li>
<li>Added proguard rule for MerchantFilter</li>
<li>Added merchants search method.</li>
<li>Added MerchantSearchResult and DisplayStore models.</li>
<li>Added required fields to DisplayProduct and Merchant. Use SearchMerchantResult and SearchProductResult as wrappers. </li>
<li>Added TermsAndCondtitions.</li>
<li>Added merchant_id as a param to SearchData.</li>
<li>Added ProductSearchData and MerchantSearchData.</li>
<li>Added toString, eqals and hashcode methods to new and modified classes. </li>
<li>Added ProductSearchInterface and MerchantSearchInterface.</li>
<li>Added &quot;total&quot; field to search responses. </li>
<li>Added &quot;itemsPerPage&quot; to SearchData.</li>
<li>Added support for too large quantity error</li>
<li>Added missing return statement in Links.jsonToEntity</li>
<li>Added factory method to create PageNavigationFilter from Link object</li>
<li>Added getOkHttpClient to HttpClient</li>
<li>Added distance field to Merchant<br/><br/></li>
<li>Changed /options endpoint to v4</li>
<li>Fixed rder details under my Activity shows QR for Delivery orders</li>
<li>Changed /category endpoint used by ScanManager to v2.</li>
<li>Changed item limit back to 30.</li>
<li>Changed product to be parcelable</li>
<li>Changed torch support methods to reside in another class.</li>
<li>Changed all interfaces to extend error interface.</li>
<li>Changed scan logic to move away from ScanManager.</li>
<li>Changed image reader to reside in ScanImageHelper class.</li>
<li>Changed scan audio logic moved to ScanAudioHelper</li>
<li>Changed RezolveScanResult modification to prevent returning to the user if the engagement has expired.</li>
<li>Changed clear cache thread priority to background. Make Credentials fields final.</li>
<li>Changed so allowed to add interceptors to HttpClientConfig.</li>
<li>Changed OrderDetails status to enum.</li>
<li>Changed; if scanned image is a QR code, check if it belongs to rezolve.</li>
<li>Change type of returned scan errors.</li>
<li>Fixed return error type for scan error.</li>
<li>Changed new &#39;include_cart_button_on_listing&#39; flag to be handled by Android SDK</li>
<li>Changed cart buttons flag by moving to Category.</li>
<li>Fixed query param name.</li>
<li>Changed CustomAttribute to AdditionalAttribute</li>
<li>Fixed bug in HttpClient.enqueueRequest method that could crash the app.</li>
<li>Changed HttpResponse implementation to throw catched exceptions.</li>
<li>Changed MerchantFilter enum name to MerchantVisibility.</li>
<li>Changed override onSearchMerchantsSuccess in MerchantCallback</li>
<li>Changed do not set param to all when product type is null. This option is not supported yet on the - server side.</li>
<li>Changed SearchOrderBy by replacing with MerchantSearchOrderBy, ProductSearchOrderBy</li>
<li>Changed search data param include_in_result -&gt; include_in_results</li>
<li>Fixed hashCode, equals implementation in (Merchant|Product)SearchData</li>
<li>Fixed bug in DisplayProduct.jsonToEntity</li>
<li>Changed include_in_results param to have lowercase values (all, products, acts)</li>
<li>Changed Link[] to Links object with named fields<br/><br/></li>
<li>Deprecated old getMerchants method. </li>
<li>Deprecate old /category methods.</li>
</ul>
<h2 id='android-v2-0-1-ios-v1-11-20-nov-21-2018'>Android v2.0.1, IOS v1.11.20 - Nov 21, 2018</h2><h3 id='documentation-changes-2'>Documentation Changes</h3>
<ul>
<li>Added tutorial on how to present data for an Act.</li>
<li>New install instructions for IOS SDK (CocoaPods)</li>
<li>New install instructions for Android SDK (Nexus/Maven)</li>
</ul>
<h3 id='ios-changes-3'>IOS Changes</h3>
<ul>
<li><code>HistoryItemProduct</code> implementation changed</li>
<li>Scanmanager internal libraries updated</li>
<li><code>CheckoutBundleV2.deliveryMethod</code> changed type to <code>DeliveryMethod?</code></li>
<li><code>CheckoutBundleV2.paymentMethod</code> changed type to <code>SupportedPaymentMethod?</code></li>
<li><code>createProductCheckoutBundleV2</code> changed parameter type from <code>deliveryMethod</code> to <code>DeliveryMethod</code></li>
<li><code>createProductCheckoutBundleV2</code> changed parameter type from <code>paymentMethod</code> to <code>SupportedPaymentMethod?</code></li>
<li><code>createCartCheckoutBundleV2</code> changed parameter type from <code>deliveryMethod</code> to <code>DeliveryMethod</code></li>
<li><code>createCartCheckoutBundleV2</code> changed parameter type from <code>paymentMethod</code> to <code>SupportedPaymentMethod?</code></li>
</ul>
<h3 id='android-changes-2'>Android Changes</h3>
<ul>
<li>Added abort purchase method to cancel orders without cleaning the cart on QuickPass canceling.</li>
<li>Fixed wrong base price with certain options</li>
</ul>
<h2 id='android-v2-0-0-ios-v1-11-10-october-11-2018'>Android v2.0.0, IOS v1.11.10 - October 11, 2018</h2><h3 id='major-documentation-changes'>Major Documentation Changes</h3>
<ul>
<li>Added tutorial for Trigger Manager</li>
<li>Added tutorial for Background Listening</li>
<li>Added tutorial for Click &amp; Collect</li>
<li>Removed manually created module reference docs and replaced them with module reference docs generated from source. </li>
</ul>
<h3 id='ios'>IOS</h3><h4 id='added'>Added</h4>
<ul>
<li>Support for virtual products</li>
<li><code>x-rezolve-device-id</code> for all Core calls</li>
<li><code>authorizationCallback</code> in DataClient so we can intercept when 401 is thrown by the server</li>
<li><code>PaymentOptionManager</code></li>
<li><code>CheckoutManagerV2</code></li>
<li><code>CheckoutBundleV2</code></li>
</ul>
<h4 id='changed'>Changed</h4>
<ul>
<li>License file</li>
<li>Updated <code>deviceId</code> payload key for login calls</li>
<li>New <code>paymentOption</code> attribute on <code>CheckoutBundle</code></li>
<li><code>CheckoutBundle</code> helper functions have a new parameter: <code>paymentOption</code></li>
<li>New attribute <code>orderId</code> on Order entity</li>
<li><code>CheckoutManager.checkout(bundle:callback:errorCalback:)</code> is now supporting <code>paymentOption</code></li>
<li><code>CheckoutManager.buy(bundle:paymentRequest:location:phone:callback:errorCallback:)</code> is now supporting <code>paymentOption</code></li>
<li>Updated <code>CheckoutOrder</code> object with new properties</li>
<li>Updated scan resolver</li>
<li>Fixed deserialisation method from history transaction.</li>
<li>Fixed <code>CartManager.removeCartProduct(merchantId:cart:product:callback:errorCallback:)</code> removal of products cotaining options or ACT</li>
<li>Fixed <code>CartManager</code>: The payment_option key removed from the payload</li>
<li>Fixed <code>InStorePickupManager</code>: The <code>payment_option</code> key removed from the payload</li>
<li>Fixed On createSession 401 weren&#39;t dispatching properly error to app handle it.</li>
<li>Fixed <code>PaymentOptionManager.getProductOptions(checkoutProduct:merchantId:callback:errorCallback:)</code> updated JSON sent to server</li>
<li>Fixed Regression serialisation on <code>CustomOption.swift</code></li>
<li><code>getScanManager</code> now accept username, password and env as parameter</li>
<li>Deprecated <code>ProductManager.getProductsAndCategories</code>, use <code>ProductManager.getProductsAndCategoriesV2</code> instead.</li>
<li>Deprecagted <code>ProductManager.getCategories</code> use <code>ProductManager.getPaginatedCategories</code> instead</li>
<li>Breaking change: <code>Merchant.contactInformation</code> type changed from tuple to class</li>
<li>Breaking change: Order have a new property orderId</li>
<li>Breaking change: <code>HistoryTransaction</code> model updated</li>
<li>Breaking change: Change type of &quot;value&quot; member on <code>CustomOption</code> from <code>Any?</code> to <code>[String]</code></li>
<li>Breaking change: <code>PaymentOptionManager.getProductOptions(checkoutProduct:merchantId:callback:errorCallback:)</code> updated JSON sent to server</li>
</ul>
<h4 id='deleted'>Deleted</h4>
<ul>
<li>Removed Websocket support from SDK</li>
<li>Custom Option Array Fix.</li>
</ul>
<h3 id='android'>Android</h3><h4 id='added-2'>Added</h4>
<ul>
<li>List of <code>CustomConfigurableOptions</code> added to <code>OrderProduct</code> class.</li>
<li><code>CustomOption</code> fields for user input.</li>
<li><code>getOrdersV2</code> method in <code>UserActivityManager</code></li>
<li><code>NotificationHelper</code> class.</li>
<li><code>TriggerManager</code> class.</li>
<li><code>isVirtual</code> flag for Product.</li>
<li><code>PaymentOptionManager</code></li>
<li><code>CheckoutManagerV2</code></li>
<li><code>CheckoutBundleV2</code></li>
<li><code>DeliveryMethod</code></li>
<li>Rezolve Auto Detect Service to listen for ads in backgorund</li>
<li>Credit Cards may have the number fully edited by users</li>
<li>Auto Torch for the scan screen. If the device has a light sensor the scan screen is able to turn on the flash light automatically to help on capture process.</li>
<li>Rezolve Auto Detect Service to listen for ads in backgorund</li>
<li>Credit Cards may have the number fully edited by users</li>
<li>Read custom resolver url from shared preferences.</li>
</ul>
<h4 id='changed-2'>Changed</h4>
<ul>
<li><code>CustomConfigurableOptions</code> added to <code>CheckoutProduct</code>.</li>
<li>Fixed parsing methods for shipping details.</li>
<li><code>CustomOption</code> optionId is now an integer.</li>
<li>Fixed a bug on <code>CustomOption</code> validator that prevented the validation of dates.</li>
<li>Fixed QR codes scan.</li>
<li>Fixed the location sent on a buy if the user didn&#39;t allow location on the app.</li>
<li>Fixed several improvements and bugfixes on the video and audio scan process.</li>
<li>New LICENSE.TXT file with updated use terms.</li>
<li>Fixed a bug where starting the Rezolve Auto Detect Service before login could crash the SDK.</li>
<li>Fixed an issue that could crash the SDK if a credit card data was updated without changes on the credit card number.</li>
<li>Fixed <code>StoreAddress</code> model.</li>
<li>Fixed issue when <code>ScanManager</code> torch methods were not responsive.</li>
</ul>
<h2 id='android-v1-7-5-ios-v1-7-6-1-july-9-2018'>Android v1.7.5, IOS v1.7.6.1 - July 9, 2018</h2>
<p>Note: This update only changes the IOS version. </p>
<h3 id='changed-3'>Changed</h3>
<ul>
<li>Updated IOS version to be compatible with IOS version 9 and onward, instead of 10 and onward</li>
<li>Updated IOS to be compatible with latest releases of SWIFT (4.x) and XCode (9.x)</li>
</ul>
<h2 id='android-v1-7-5-ios-v1-6-5-may-5-2018'>Android v1.7.5, IOS v1.6.5 - May 5, 2018</h2><h3 id='added-3'>Added</h3>
<ul>
<li>New section on Generic JWT Authentication, with sequence diagram.</li>
<li>AuthenticationManager.createSession, v2, added.</li>
<li><code>MerchantManager</code> class added</li>
<li><code>CheckoutBundle</code> class added (see CheckoutManager class for details)</li>
<li><code>ProductManager.getgetProductsAndCategories</code> method added</li>
<li><code>ProductManager.getParentCategory</code> method added (Android Only)</li>
<li><code>ProductManager.getCartProduct</code> method added (Android Only)</li>
</ul>
<h3 id='changed-4'>Changed</h3>
<ul>
<li>Instancing the SDK via <code>RezolveSDK.getInstance</code> used to take an enum to specify environment. This is now takes a string.  <code>RezolveSDK.getInstance(String API_KEY, String ENVIRONMENT)</code>. For the Sandbox, ENVIRONMENT should equal <code>sandbox-api-tw.rzlvtest.co</code> in IOS, and <code>https://sandbox-api-tw.rzlvtest.co/api</code> in Android. Changed in many code samples.<br></li>
<li>Updated all sequence diagrams for v2 authentication, using JWT.</li>
<li>Added new SDK download process.</li>
<li>Product Scan, Instant Buy Flow - 

<ul>
<li>Updated code samples for <code>CheckoutManager</code> changes.<br></li>
<li>Revised sequence diagram. </li>
</ul></li>
<li>Product Scan, Cart Flow

<ul>
<li>Updated code samples for <code>CheckoutManager</code> changes. </li>
<li>Updated Category structure. </li>
<li>Revised sequence diagram. </li>
</ul></li>
<li>Category Scan Flow

<ul>
<li>Simplified calls.</li>
<li>Updated Category structure.</li>
<li>Revised sequence diagram.</li>
</ul></li>
<li>Mall flow 

<ul>
<li>Updated <code>getMerchants</code> method</li>
<li>Updated Category structure. Simplified subsequent calls</li>
<li>Revised sequence diagram. </li>
</ul></li>
<li><code>AuthenticationManager</code> class

<ul>
<li><code>.register</code> deprecated</li>
<li>v1 <code>.createSession</code> deprecated</li>
<li>v1 <code>.logout</code> deprecated<br></li>
<li>V2 <code>.createSession</code> has been added, using JWT accessToken, and removing deviceProfile. CreateSession change made to all sequence diagrams.</li>
</ul></li>
<li><code>CheckoutManager</code> class

<ul>
<li>Added CheckoutBundle class documentation</li>
<li>Revised checkout methods and purchase methods to use CheckoutBundles</li>
</ul></li>
<li><code>ProductManager</code> class<br>

<ul>
<li><code>getCategory</code> now takes category object as a parameter, instead of category id. </li>
<li><code>getProduct</code> now takes a product object as a parameter, instead of a product id.</li>
<li><code>onGetProductsSuccess</code> now uses <code>getItems</code> instead of <code>getProducts</code> to extract DisplayProducts. </li>
<li>Updated <code>Category</code> objects</li>
</ul></li>
</ul>
<h3 id='deleted-2'>Deleted</h3>
<ul>
<li>The enum to represent the target Rezolve environment <code>RezolveSDK.Env.EvironmentName</code> is removed.</li>
<li>DeviceProfile object removed from createSession. </li>
<li>Removed Merchant handling from ProductManager</li>
</ul>
<h2 id='android-v1-5-37-ios-v1-5-40-dec-19-2017'>Android v1.5.37, IOS v1.5.40 - Dec 19 2017</h2><h3 id='added-4'>Added</h3>
<ul>
<li>PhonebookManager Class</li>
<li>MerchantManager Class</li>
<li>ProductManager.getCartProduct </li>
<li>ProductManager.getParentCategory</li>
<li>ProductManager.getProductsAndCategories</li>
</ul>
<h3 id='changed-5'>Changed</h3>
<ul>
<li>Product Scan, Cart Flow example - updated code samples to reflect changes in CheckoutManager, rezolveLocation object</li>
<li>Product Scan, Cart Flow example - updated sequence diagram and narrative to better describe role of signOrderUpdates call.</li>
<li>Product Scan, Instant Buy flow example - updated code samples to reflect chnges in CheckoutManager, rezolveLocation object</li>
<li>Product Scan, Instant Buy flow example - updated sequence diagram and narrative to better describe role of signOrderUpdates call.</li>
<li>CheckoutManager.buyCart - added phonebookId to method parameters. Removed &quot;Type&quot; from RezolveLocation object.</li>
<li>CheckoutManager.buyProduct - added phonebookId to method parameters. Removed &quot;Type&quot; from RezolveLocation object.</li>
<li>CheckoutManager.signOrderUpdates - remove from response:

<ul>
<li>Transaction.transactionAmount (Order object)</li>
<li>Transaction.transactionItems list</li>
<li>remove Transaction.Timestamp from response</li>
</ul></li>
<li>CheckoutManager.signOrderUpdates - clarified narrative describing socket listener behavior.</li>
<li>ProductManager.getProduct - change method name from product.getOptionAvailable() product.getOptionsAvailable()  (plural)</li>
<li>UserActivityManager.getOrders request - add &quot;from&quot; and &quot;to&quot; date parameters to request parameters</li>
<li>UserActivityManager.getOrders response - orderDetails.getItems() now returns a list of OrderProduct objects, instead of HistoryItem objects</li>
<li>UserActivityManager.getOrders response - remove from the OrderDetails object: 

<ul>
<li>Type</li>
<li>RezolveLocation.Type</li>
</ul></li>
<li>UserActivityManager.getOrders response - rename object FinalPrice to Price</li>
<li>UserActivityManager.getOrders response - add to the OrderDetails object:

<ul>
<li>Partner Id</li>
<li>Billing Address</li>
<li>Shipping Address</li>
<li>Email</li>
<li>First Name</li>
<li>Last Name</li>
<li>Phone</li>
<li>Merchant Email</li>
<li>Merchant Name</li>
<li>Merchant Phone</li>
</ul></li>
</ul>
<h3 id='deleted-3'>Deleted</h3>
<ul>
<li>none</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="swift">IOS</a>
                <a href="#" data-language-name="java">Android</a>
          </div>
      </div>
    </div>
  </body>
</html>
